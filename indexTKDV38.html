<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TKD Championship 2025 â€” Quáº£n lÃ½ giáº£i Pickleball V39 GitHub (Sá»­a lá»—i Nháº­p Ä‘iá»ƒm & Äá»“ng bá»™ Ranking)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f9fc; font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#222; padding:18px; }
    .tab-content { margin-top: 18px; }
    .logo { 
      width:64px; 
      height:64px; 
      object-fit:contain; 
      border-radius:8px; 
      border:1px solid #e6eefc; 
      padding:6px; 
      background:#fff; 
    }
    table th { background:#0d6efd; color:#fff; position:sticky; top:0; }
    .status { font-size:0.95rem; color:#555; }
    /* Responsive adjustment for match inputs */
    .match-score-cell input {
      width: 45px;
      text-align: center;
      padding: 0.1rem;
    }
    @media (max-width: 576px) {
      .match-score-cell input {
        width: 35px;
      }
    }
    .winner { font-weight: bold; color: green; }
    .loser { color: red; }
    .ranking-container { display: flex; flex-direction: column; gap: 20px; }
    @media (min-width: 768px) {
        .ranking-container { flex-direction: row; }
        .ranking-container > div { flex: 1; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
      <img class="logo" src="data/logoTKD.png" alt="Logo TKD">
      <div>
        <h3 class="mb-0">TKD Championship 2025</h3>
        <div>NgÃ y thi Ä‘áº¥u: 18/10/2025 (**V39**)</div>
      </div>
    </div>
    <div>
      <div id="autoSaveStatus" class="text-end status">Auto-save (30s): <span id="autoState" class="text-danger">Táº¯t</span></div>
      <div id="lastSaved" class="text-end status">ChÆ°a lÆ°u</div>
    </div>
  </div>

  <ul class="nav nav-tabs" id="mainTabs">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#overview" onclick="renderOverview()">Tá»•ng quan</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#matches" id="matchesTabButton" onclick="renderMatchesView()">VÃ²ng Báº£ng</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#finals" onclick="renderFinals()">VÃ²ng Chung Káº¿t</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#results" onclick="tinhVaCapNhatXepHang(); renderFinalResults();">Káº¿t quáº£ Chung cuá»™c</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#config" id="configTabButton" onclick="renderConfig()">Cáº¥u hÃ¬nh</button></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active p-3" id="overview">
        <div id="overviewContent">Äang táº£i dá»¯ liá»‡u...</div>
    </div>
    
    <div class="tab-pane fade p-3" id="matches">
      <div class="d-flex gap-2 mb-3 flex-wrap">
        <label for="viewMode" class="form-label mb-0 align-self-center text-nowrap">Cháº¿ Ä‘á»™ xem:</label>
        <select id="viewMode" class="form-select form-select-sm w-auto" onchange="renderMatchesView()">
            <option value="table">Theo Báº£ng Ä‘áº¥u</option>
            <option value="court" selected>Theo SÃ¢n thi Ä‘áº¥u</option>
        </select>
        
        <button class="btn btn-sm btn-info ms-auto" onclick="document.getElementById('fileInput').click()">Import Lá»‹ch (CSV)</button>
        <input type="file" id="fileInput" accept=".csv" style="display: none;" onchange="handleFileSelect(event)">
        
        <button class="btn btn-sm btn-warning" onclick="exportSchedule()">Export Lá»‹ch (CSV)</button>
      </div>
      
      <div id="matchesViewContent">
        <h6 id="scheduleAHeader" class="mt-4">Báº£ng A (Nam - Ná»¯)</h6><div id="tableMatchesA">ChÆ°a cÃ³ lá»‹ch thi Ä‘áº¥u.</div>
        
        <h6 class="mt-4">Báº£ng B (Nam)</h6><div id="tableMatchesB">ChÆ°a cÃ³ lá»‹ch thi Ä‘áº¥u.</div>
      </div>

      <button class="btn btn-warning mt-4" onclick="scheduleFinalsAuto()">LÃªn lá»‹ch VÃ²ng Chung káº¿t (Tá»± Ä‘á»™ng hÃ³a)</button>
    </div>

    <div class="tab-pane fade p-3" id="finals">
        <div id="finalsContent">
            <h6 class="mt-4">VÃ²ng BÃ¡n káº¿t (SF1: 16:40, SF2: 17:05, SÃ¢n 3)</h6>
            <div id="semifinalMatches">ChÆ°a cÃ³ lá»‹ch thi Ä‘áº¥u bÃ¡n káº¿t. Káº¿t quáº£ VÃ²ng Báº£ng sáº½ tá»± Ä‘á»™ng cáº­p nháº­t lá»‹ch.</div>

            <h6 class="mt-4">Tráº­n Chung káº¿t (17:30, SÃ¢n 3)</h6>
            <div id="finalMatch">ChÆ°a cÃ³ lá»‹ch thi Ä‘áº¥u chung káº¿t.</div>
        </div>
    </div>

    <div class="tab-pane fade p-3" id="results">
        <h5 class="mb-3">Báº£ng xáº¿p háº¡ng VÃ²ng Báº£ng (Æ¯u tiÃªn: W > Äá»‘i Ä‘áº§u > Hiá»‡u sá»‘ > Tá»•ng Ä‘iá»ƒm)</h5>
        <div id="rankingTables" class="ranking-container">
            </div>

        <hr class="my-4">

        <h5 class="mb-3">Danh hiá»‡u Chung cuá»™c</h5>
        <p id="champion">VÃ´ Ä‘á»‹ch: Äang chá» káº¿t quáº£...</p>
        <p id="runnerUp">Ã quÃ¢n: Äang chá» káº¿t quáº£...</p>
        <p id="thirdPlace">Háº¡ng Ba Äá»“ng Háº¡ng: Äang chá» káº¿t quáº£...</p>
    </div>

    <div class="tab-pane fade p-3" id="config">
      <h5 class="mb-3">CÃ´ng cá»¥ Láº­p & Äiá»n Lá»‹ch Thi Ä‘áº¥u</h5>
      <div class="d-flex gap-2 mb-4 flex-wrap">
        <button class="btn btn-sm btn-primary" onclick="taoLichThiDauCungGio()">Táº¡o lá»‹ch thi Ä‘áº¥u Tá»‘i Æ°u (Tá»± Ä‘á»™ng)</button>
        <button class="btn btn-sm btn-secondary" onclick="taoLichCoDinh()">Táº£i lá»‹ch Máº«u (**CalendarTKD30**)</button>
        <button class="btn btn-sm btn-success" onclick="autoFillScores()">Äiá»n káº¿t quáº£ Tá»± Ä‘á»™ng (11 - X)</button>
        <button class="btn btn-sm btn-danger" onclick="clearAllSchedules()">XÃ³a ToÃ n bá»™ Lá»‹ch</button>
      </div>
      
      <hr>
      
      <h5 class="mt-4">ğŸ§¹ CÃ´ng cá»¥ XÃ³a Káº¿t quáº£ VÃ²ng Báº£ng</h5>
      <div class="d-flex gap-2 mb-4 flex-wrap">
          <button class="btn btn-sm btn-outline-danger" onclick="clearGroupScores('A')">XÃ³a Káº¿t quáº£ Báº£ng A</button>
          <button class="btn btn-sm btn-outline-danger" onclick="clearGroupScores('B')">XÃ³a Káº¿t quáº£ Báº£ng B</button>
          <button class="btn btn-sm btn-danger ms-auto" onclick="clearGroupScores('ALL')">XÃ³a ToÃ n bá»™ VÃ²ng Báº£ng</button>
      </div>
      <div id="clearScoreStatus"></div>
      <hr>
      <h5 class="mt-4">âš™ï¸ Cáº¥u hÃ¬nh SÃ¢n thi Ä‘áº¥u & Lá»‹ch Tá»‘i Æ°u</h5>
      <p class="text-muted small">Quáº£n lÃ½ danh sÃ¡ch sÃ¢n thi Ä‘áº¥u. SÃ¢n Ä‘Æ°á»£c gÃ¡n loáº¡i báº£ng Ä‘áº¥u (A/B) Ä‘á»ƒ phá»¥c vá»¥ chá»©c nÄƒng táº¡o lá»‹ch Tá»‘i Æ°u.</p>
      <div class="d-flex gap-2 mb-3 flex-wrap">
          <button class="btn btn-sm btn-primary" onclick="openCourtModal()">+ ThÃªm SÃ¢n Má»›i</button>
          <button class="btn btn-sm btn-outline-info" onclick="loadDefaultCourtConfig()">Táº£i cáº¥u hÃ¬nh Máº·c Ä‘á»‹nh</button>
      </div>
      <div id="courtListContainer">
          </div>
      <div id="courtConfigStatus"></div>
      <hr>
      
      <h5 class="mt-4">ğŸ› ï¸ Cáº¥u hÃ¬nh Tá»‘i Æ°u Lá»‹ch thi Ä‘áº¥u</h5>
      <div class="row g-2 mb-4">
        <div class="col-md-6">
          <label for="preferredCourtType" class="form-label">Æ¯u tiÃªn SÃ¢n nÃ o cho tráº­n Ä‘áº§u tiÃªn (Chá»©c nÄƒng Táº¡o lá»‹ch Tá»‘i Æ°u)?</label>
          <select id="preferredCourtType" class="form-select" onchange="updatePreferredCourtType()">
            <option value="mixed">Báº£ng A (Nam - Ná»¯) - Máº·c Ä‘á»‹nh</option>
            <option value="male">Báº£ng B (Nam)</option>
          </select>
          <div class="form-text">XÃ¡c Ä‘á»‹nh loáº¡i sÃ¢n sáº½ Ä‘Æ°á»£c Æ°u tiÃªn gÃ¡n tráº­n Ä‘áº¥u Ä‘áº§u tiÃªn trong thuáº­t toÃ¡n táº¡o lá»‹ch.</div>
        </div>
        <div class="col-md-6">
            <label class="form-label">CÃ´ng cá»¥ Xuáº¥t/LÆ°u Dá»¯ liá»‡u</label>
            <div class="d-flex gap-2">
                 <button class="btn btn-success" onclick="saveToGitHub(true)">Cáº­p nháº­t lÃªn GitHub ngay</button>
                 <button class="btn btn-secondary" onclick="exportDataToJson()">Xuáº¥t táº¥t cáº£ ra JSON</button>
            </div>
            <div class="form-text">LÆ°u tráº¡ng thÃ¡i hiá»‡n táº¡i (state.json) lÃªn GitHub hoáº·c táº£i vá» mÃ¡y.</div>
        </div>
      </div>
      <hr>
      <h5 class="mt-4">ğŸ’¾ Cáº¥u hÃ¬nh Káº¿t ná»‘i GitHub</h5>
      <p class="text-muted">Nháº­p thÃ´ng tin kho lÆ°u trá»¯ GitHub Ä‘á»ƒ tá»± Ä‘á»™ng lÆ°u trá»¯ dá»¯ liá»‡u giáº£i Ä‘áº¥u (Auto-save: 30s).</p>
      <div class="row g-2 mb-2">
        <div class="col-md-3"><input id="cfgOwner" class="form-control" placeholder="Owner (VÃ­ dá»¥: user_name)"></div>
        <div class="col-md-3"><input id="cfgRepo" class="form-control" placeholder="Repo (VÃ­ dá»¥: my-data-repo)"></div>
        <div class="col-md-3"><input id="cfgFolder" class="form-control" value="data"></div>
        <div class="col-md-3"><input id="cfgFile" class="form-control" value="state.json"></div>
      </div>
      <input id="cfgToken" type="password" class="form-control mb-2" placeholder="DÃ¡n GitHub Personal Access Token (PAT) táº¡i Ä‘Ã¢y">
      <div class="d-flex gap-2">
        <button class="btn btn-primary" onclick="saveConfig()">LÆ°u cáº¥u hÃ¬nh Local</button>
        <button class="btn btn-success" onclick="checkConnection()">Kiá»ƒm tra & Táº£i Dá»¯ liá»‡u</button>
      </div>
      <div class="mt-2" id="configStatus"></div>
      
      <div class="card bg-light mt-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-info">ğŸ”‘ HÆ°á»›ng dáº«n láº¥y GitHub Token (PAT)</h5>
            <ol class="small mb-0">
                <li>Truy cáº­p <a href="https://github.com/settings/tokens" target="_blank" class="text-info">GitHub Tokens Settings</a> (Báº¡n cáº§n Ä‘Äƒng nháº­p).</li>
                <li>Chá»n **Generate new token** (hoáº·c **Generate new token (classic)** náº¿u báº¡n dÃ¹ng tÃ i khoáº£n cÅ©).</li>
                <li>**TÃªn Token:** Äáº·t tÃªn dá»… nhá»› (vÃ­ dá»¥: `TKDManager_AutoSave`).</li>
                <li>**Thá»i háº¡n:** Chá»n tÃ¹y Ã½ (nÃªn chá»n 90 ngÃ y hoáº·c TÃ¹y chá»‰nh).</li>
                <li>**Pháº¡m vi (Scopes):** **Báº®T BUá»˜C** tÃ­ch chá»n Ã´ **`repo`** (cho phÃ©p truy cáº­p vÃ o kho lÆ°u trá»¯).</li>
                <li>Nháº¥n **Generate token** vÃ  **SAO CHÃ‰P** chuá»—i Token vá»«a Ä‘Æ°á»£c táº¡o.</li>
                <li>DÃ¡n chuá»—i Token Ä‘Ã³ vÃ o Ã´ "DÃ¡n GitHub Personal Access Token (PAT) táº¡i Ä‘Ã¢y" bÃªn trÃªn.</li>
            </ol>
            <p class="mt-2 mb-0 text-danger small">âš ï¸ **LÆ°u Ã½:** Token chá»‰ hiá»ƒn thá»‹ **Má»˜T Láº¦N**. HÃ£y sao chÃ©p ngay láº­p tá»©c vÃ  giá»¯ bÃ­ máº­t. Náº¿u máº¥t, báº¡n pháº£i táº¡o láº¡i Token má»›i.</p>
        </div>
      </div>
      </div>
  </div>
</div>

<div class="modal fade" id="courtModal" tabindex="-1" aria-labelledby="courtModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="courtModalLabel">ThÃªm/Sá»­a Cáº¥u hÃ¬nh SÃ¢n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="courtForm">
          <input type="hidden" id="courtIndex" value="">
          <div class="mb-3">
            <label for="courtName" class="form-label">TÃªn SÃ¢n</label>
            <input type="text" class="form-control" id="courtName" required>
          </div>
          <div class="mb-3">
            <label for="courtStartTime" class="form-label">Giá» Báº¯t Äáº§u (HH:mm)</label>
            <input type="time" class="form-control" id="courtStartTime" required>
          </div>
          <div class="mb-3">
            <label for="courtMaxDuration" class="form-label">Thá»i LÆ°á»£ng Tá»‘i Äa (PhÃºt)</label>
            <input type="number" class="form-control" id="courtMaxDuration" min="1" required>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="courtIsMixed">
            <label class="form-check-label" for="courtIsMixed">
              DÃ nh cho Báº£ng A (Nam - Ná»¯)
            </label>
            <div class="form-text">Náº¿u khÃ´ng chá»n, sÃ¢n sáº½ dÃ nh cho Báº£ng B (Nam).</div>
          </div>
          <div id="courtFormStatus" class="mt-2"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
        <button type="button" class="btn btn-primary" onclick="saveCourtChanges()">LÆ°u Thay Äá»•i</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="customAlertModal" tabindex="-1" aria-labelledby="customAlertModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customAlertModalLabel">ThÃ´ng bÃ¡o</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="customAlertModalBody">
        Ná»™i dung thÃ´ng bÃ¡o
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ÄÃ³ng</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script> 

<script>
// Dá»¯ liá»‡u lá»‹ch cá»‘ Ä‘á»‹nh tá»« file CalendarTKD30.csv (ÄÃƒ Cáº¬P NHáº¬T theo yÃªu cáº§u)
const FIXED_SCHEDULE_CSV = `teamA,teamB,time,court,bang,scoreA,scoreB
Triá»u/Minh,Hiá»ƒn/P.HÃ¹ng,14:00,SÃ¢n 1,B,,
Giang/Long,HÆ°á»ng/Äáº¡t,14:00,SÃ¢n 2,A,,
Háº­u/DÅ©ng,Háº¡nh/Tiáº¿n,14:00,SÃ¢n 3,A,,
Huyá»n/LuÃ¢n,Linh/M.HÃ¹ng,14:00,SÃ¢n 7,A,,
Tiá»‡p/Thá»§y,PhÆ°Æ¡ng/Thanh,14:15,SÃ¢n 1,B,,
TÃ­n/KhiÃªm,Ãnh/ToÃ n,14:15,SÃ¢n 2,B,,
Háº­u/DÅ©ng,HÆ°á»ng/Äáº¡t,14:15,SÃ¢n 3,A,,
Giang/Long,Huyá»n/LuÃ¢n,14:15,SÃ¢n 7,A,,
Triá»u/Minh,TÃ­n/KhiÃªm,14:30,SÃ¢n 1,B,,
Tiá»‡p/Thá»§y,Hiá»ƒn/P.HÃ¹ng,14:30,SÃ¢n 2,B,,
Háº¡nh/Tiáº¿n,Linh/M.HÃ¹ng,14:30,SÃ¢n 3,A,,
PhÆ°Æ¡ng/Thanh,Ãnh/ToÃ n,14:30,SÃ¢n 7,B,,
Huyá»n/LuÃ¢n,HÆ°á»ng/Äáº¡t,14:45,SÃ¢n 2,A,,
Háº¡nh/Tiáº¿n,Giang/Long,14:45,SÃ¢n 3,A,,
Háº­u/DÅ©ng,Linh/M.HÃ¹ng,14:45,SÃ¢n 7,A,,
Tiá»‡p/Thá»§y,Ãnh/ToÃ n,15:00,SÃ¢n 2,B,,
TÃ­n/KhiÃªm,Hiá»ƒn/P.HÃ¹ng,15:00,SÃ¢n 3,B,,
PhÆ°Æ¡ng/Thanh,Triá»u/Minh,15:15,SÃ¢n 2,B,,
Giang/Long,Linh/M.HÃ¹ng,15:15,SÃ¢n 3,A,,
Háº¡nh/Tiáº¿n,HÆ°á»ng/Äáº¡t,15:30,SÃ¢n 2,A,,
Háº­u/DÅ©ng,Huyá»n/LuÃ¢n,15:30,SÃ¢n 3,A,,
Tiá»‡p/Thá»§y,TÃ­n/KhiÃªm,15:45,SÃ¢n 2,B,,
PhÆ°Æ¡ng/Thanh,Hiá»ƒn/P.HÃ¹ng,15:45,SÃ¢n 3,B,,
Triá»u/Minh,Ãnh/ToÃ n,16:00,SÃ¢n 2,B,,
Háº­u/DÅ©ng,Giang/Long,16:00,SÃ¢n 3,A,,
Háº¡nh/Tiáº¿n,Huyá»n/LuÃ¢n,16:15,SÃ¢n 2,A,,
Linh/M.HÃ¹ng,HÆ°á»ng/Äáº¡t,16:15,SÃ¢n 3,A,,
Tiá»‡p/Thá»§y,Triá»u/Minh,16:30,SÃ¢n 2,B,,
Ãnh/ToÃ n,Hiá»ƒn/P.HÃ¹ng,16:30,SÃ¢n 3,B,,
PhÆ°Æ¡ng/Thanh,TÃ­n/KhiÃªm,16:45,SÃ¢n 2,B,`;

// Biáº¿n state lÆ°u trá»¯ dá»¯ liá»‡u chÃ­nh cá»§a á»©ng dá»¥ng.
let state = { 
  mixedTeams: [], // Sáº½ Ä‘Æ°á»£c táº£i tá»« players.json
  maleTeams: [],  // Sáº½ Ä‘Æ°á»£c táº£i tá»« players.json
  matchesA: [], 
  matchesB: [],
  tableA: [], // Báº£ng xáº¿p háº¡ng A (Sáº½ Ä‘Æ°á»£c lÆ°u vÃ  táº£i)
  tableB: [], // Báº£ng xáº¿p háº¡ng B (Sáº½ Ä‘Æ°á»£c lÆ°u vÃ  táº£i)
  
  // Court Configuration
  courts: [
    { name: 'SÃ¢n 1', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
    { name: 'SÃ¢n 2', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
    { name: 'SÃ¢n 3', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
    { name: 'SÃ¢n 4', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
    { name: 'SÃ¢n 5', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
    { name: 'SÃ¢n 6', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
    { name: 'SÃ¢n 7', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
    { name: 'SÃ¢n 8', startTime: '14:00', maxDurationMinutes: 180, isMixed: false } 
  ],
  
  // LOGIC BÃN Káº¾T 
  semifinals: [
    { id: 'SF1', teamA: 'Nháº¥t A', teamB: 'NhÃ¬ A', scoreA: null, scoreB: null, time: '16:40', court: 'SÃ¢n 3', winner: null, loser: null }, 
    { id: 'SF2', teamA: 'Nháº¥t B', teamB: 'NhÃ¬ B', scoreA: null, scoreB: null, time: '17:05', court: 'SÃ¢n 3', winner: null, loser: null }  
  ],
  final: { id: 'F', teamA: 'Tháº¯ng SF1', teamB: 'Tháº¯ng SF2', scoreA: null, scoreB: null, time: '17:30', court: 'SÃ¢n 3', winner: null, runnerUp: null }, 
  config: { 
    preferredCourtType: 'mixed' 
  }
};

let stateChanged = false; // Biáº¿n cá» theo dÃµi thay Ä‘á»•i dá»¯ liá»‡u
let currentSha = null; // Biáº¿n lÆ°u trá»¯ SHA cá»§a file trÃªn GitHub
let autoSaveInterval = null; // Biáº¿n lÆ°u trá»¯ ID cá»§a interval

// --- Custom Modal Function ---
function showModal(title, body) {
    document.getElementById('customAlertModalLabel').textContent = title;
    document.getElementById('customAlertModalBody').innerHTML = body;
    const modal = new bootstrap.Modal(document.getElementById('customAlertModal'));
    modal.show();
}

/**
 * HÃ m chuyá»ƒn Ä‘á»•i tab
 * @param {string} tabId - ID cá»§a tab cáº§n chuyá»ƒn (vÃ­ dá»¥: 'matches', 'overview')
 */
function switchTab(tabId) {
    const tabElement = document.querySelector(`#mainTabs button[data-bs-target="#${tabId}"]`);
    if (tabElement) {
        // Táº¯t tab Ä‘ang active
        document.querySelectorAll('#mainTabs .nav-link').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content .tab-pane').forEach(pane => pane.classList.remove('show', 'active'));

        // Báº­t tab má»›i
        tabElement.classList.add('active');
        document.getElementById(tabId).classList.add('show', 'active');
        
        // Cáº­p nháº­t view cho tab matches náº¿u chuyá»ƒn Ä‘áº¿n
        if (tabId === 'matches') {
            renderMatchesView();
        }
    }
}

// --- Helper Functions cho Base64 ---
function b64EncodeUnicode(str) {
  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
    function(match, p1) {
      return String.fromCharCode('0x' + p1);
    }));
}

function b64DecodeUnicode(str) {
  return decodeURIComponent(atob(str).split('').map(function(c) {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
}

// --- GitHub API Functions ---

/**
 * Láº¥y SHA má»›i nháº¥t cá»§a file trÃªn GitHub.
 * @param {object} cfg - Cáº¥u hÃ¬nh GitHub (owner, repo, folder, file, token)
 * @param {string} fileName - TÃªn file cáº§n láº¥y SHA (máº·c Ä‘á»‹nh lÃ  cfg.file)
 * @returns {Promise<{sha: string|null, content: string|null}>}
 */
async function fetchFileSha(cfg, fileName = cfg.file) {
    const filePath = `${cfg.folder}/${fileName}`;
    const apiUrl = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${filePath}`;
    
    try {
        const response = await fetch(apiUrl, {
            headers: {
                'Authorization': `token ${cfg.token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            if (fileName === cfg.file) {
                 currentSha = data.sha; // Chá»‰ lÆ°u SHA cá»§a state.json
            }
            return { sha: data.sha, content: data.content };
        } else if (response.status === 404) {
            if (fileName === cfg.file) {
                 currentSha = null; 
            }
            return { sha: null, content: null };
        } else {
            // Lá»—i khÃ¡c (401, 403, 500...)
            throw new Error(`Lá»—i HTTP ${response.status}: ${response.statusText}`);
        }
    } catch (error) {
        console.error(`Lá»—i Fetch SHA (${fileName}):`, error);
        throw new Error(`Lá»—i káº¿t ná»‘i hoáº·c API: ${error.message}`);
    }
}

/**
 * Táº£i danh sÃ¡ch Ä‘á»™i tá»« players.json
 */
async function loadPlayersFromGitHub(cfg) {
    const fileName = 'players.json';
    
    try {
        updateStatus('configStatus', 'info', 'Äang táº£i danh sÃ¡ch Ä‘á»™i tá»« GitHub (players.json)...');
        const result = await fetchFileSha(cfg, fileName); 
        
        if (result.content) {
            const jsonString = b64DecodeUnicode(result.content);
            const loadedTeams = JSON.parse(jsonString);

            if (Array.isArray(loadedTeams.mixedTeams) && Array.isArray(loadedTeams.maleTeams)) {
                state.mixedTeams = loadedTeams.mixedTeams;
                state.maleTeams = loadedTeams.maleTeams;
                updateStatus('configStatus', 'success', `Táº£i danh sÃ¡ch Ä‘á»™i thÃ nh cÃ´ng (${state.mixedTeams.length + state.maleTeams.length} Ä‘á»™i).`);
                return true;
            } else {
                throw new Error("File players.json khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng (thiáº¿u mixedTeams/maleTeams).");
            }
        } else {
            updateStatus('configStatus', 'warning', 'KhÃ´ng tÃ¬m tháº¥y file players.json. DÃ¹ng danh sÃ¡ch Ä‘á»™i khá»Ÿi táº¡o (trá»‘ng).');
            return false;
        }
    } catch (error) {
        console.error("Lá»—i khi táº£i players.json:", error);
        updateStatus('configStatus', 'danger', `Lá»—i táº£i danh sÃ¡ch Ä‘á»™i: ${error.message}`);
        return false;
    }
}

/**
 * Táº£i tráº¡ng thÃ¡i giáº£i Ä‘áº¥u (state.json) tá»« GitHub.
 */
async function loadFromGitHub() {
    const cfg = state.config;
    if (!cfg.owner || !cfg.repo || !cfg.token) {
         updateStatus('configStatus', 'warning', 'Thiáº¿u thÃ´ng tin káº¿t ná»‘i GitHub. Vui lÃ²ng nháº­p Token/Repo.');
         return;
    }

    // 1. Load Teams (danh sÃ¡ch Ä‘á»™i)
    await loadPlayersFromGitHub(cfg); 

    // 2. Load App State (state.json)
    try {
        updateStatus('configStatus', 'info', 'Äang táº£i tráº¡ng thÃ¡i giáº£i Ä‘áº¥u tá»« GitHub (state.json)...');
        // fetchFileSha sáº½ tá»± Ä‘á»™ng cáº­p nháº­t currentSha
        const result = await fetchFileSha(cfg, cfg.file); 
        
        if (result.content) {
            const jsonString = b64DecodeUnicode(result.content);
            const loadedState = JSON.parse(jsonString);

            // Ghi Ä‘Ã¨ cÃ¡c giÃ¡ trá»‹ khÃ¡c ngoÃ i teams (teams Ä‘Ã£ Ä‘Æ°á»£c load tá»« players.json)
            state.matchesA = loadedState.matchesA || [];
            state.matchesB = loadedState.matchesB || [];
            
            // NEW: Táº£i báº£ng xáº¿p háº¡ng náº¿u cÃ³ 
            state.tableA = loadedState.tableA || []; 
            state.tableB = loadedState.tableB || [];
            
            if (loadedState.courts) {
                state.courts = loadedState.courts;
            }
            
            // Cáº¥u trÃºc máº·c Ä‘á»‹nh má»›i cho bÃ¡n káº¿t/chung káº¿t
            const defaultSF1 = { teamA: 'Nháº¥t A', teamB: 'NhÃ¬ A', court: 'SÃ¢n 3', time: '16:40' };
            const defaultSF2 = { teamA: 'Nháº¥t B', teamB: 'NhÃ¬ B', court: 'SÃ¢n 3', time: '17:05' };
            const defaultFinal = { teamA: 'Tháº¯ng SF1', teamB: 'Tháº¯ng SF2', court: 'SÃ¢n 3', time: '17:30' };

            // Logic táº£i cho semifinals/final (giá»¯ láº¡i káº¿t quáº£ náº¿u Ä‘Ã£ cÃ³, reset Ä‘á»™i náº¿u Ä‘á»™i vÃ²ng báº£ng thay Ä‘á»•i)
            if (loadedState.semifinals && loadedState.semifinals.length === 2) {
                 // Náº¿u Ä‘Ã£ cÃ³ Ä‘á»™i thá»±c táº¿ Ä‘Æ°á»£c gÃ¡n (vÃ­ dá»¥: Team X), giá»¯ nguyÃªn 
                state.semifinals = loadedState.semifinals;
                // Náº¿u lÃ  tráº¡ng thÃ¡i rá»—ng default (Nháº¥t A vs NhÃ¬ A), cáº­p nháº­t láº¡i thá»i gian vÃ  sÃ¢n theo V24
                state.semifinals.forEach((sf, index) => {
                     if (sf.teamA === 'Nháº¥t A' || sf.teamA === 'Nháº¥t B') {
                        sf.court = defaultSF1.court;
                        sf.time = index === 0 ? defaultSF1.time : defaultSF2.time;
                    }
                });
            } else {
                 // DÃ¹ng default V24
                 state.semifinals = [
                     { id: 'SF1', teamA: 'Nháº¥t A', teamB: 'NhÃ¬ A', scoreA: null, scoreB: null, time: defaultSF1.time, court: defaultSF1.court, winner: null, loser: null },
                     { id: 'SF2', teamA: 'Nháº¥t B', teamB: 'NhÃ¬ B', scoreA: null, scoreB: null, time: defaultSF2.time, court: defaultSF2.court, winner: null, loser: null }
                 ];
            }
            
            state.final = loadedState.final || state.final;
            if (!state.final.winner) {
                state.final.court = defaultFinal.court;
                state.final.time = defaultFinal.time;
            }
            
            updateStatus('configStatus', 'success', `Táº£i tráº¡ng thÃ¡i giáº£i Ä‘áº¥u thÃ nh cÃ´ng tá»«: ${cfg.owner}/${cfg.repo}/${cfg.folder}/${cfg.file}`);
            document.getElementById('lastSaved').textContent = `Láº§n táº£i: ${new Date().toLocaleTimeString('vi-VN')}`;
        } else {
             // File state.json khÃ´ng tá»“n táº¡i (404)
            updateStatus('configStatus', 'warning', 'File tráº¡ng thÃ¡i (state.json) chÆ°a tá»“n táº¡i. Vui lÃ²ng nháº¥n LÆ°u hoáº·c Tá»± Ä‘á»™ng lÆ°u Ä‘á»ƒ táº¡o file.');
        }
        
        // LuÃ´n cáº­p nháº­t giao diá»‡n sau khi táº£i xong teams/state (hoáº·c dÃ¹ng máº·c Ä‘á»‹nh)
        tinhVaCapNhatXepHang(); 
        renderMatchesView(); 
        renderFinals();
        renderFinalResults();
        renderOverview();
        startAutoSave();

    } catch (error) {
        updateStatus('configStatus', 'danger', `Lá»—i táº£i tráº¡ng thÃ¡i giáº£i Ä‘áº¥u: ${error.message}. Vui lÃ²ng kiá»ƒm tra láº¡i Token/Repo.`);
        console.error("Lá»—i khi táº£i tráº¡ng thÃ¡i giáº£i Ä‘áº¥u tá»« GitHub:", error);
    }
}

/**
 * LÆ°u tráº¡ng thÃ¡i giáº£i Ä‘áº¥u (state.json) lÃªn GitHub.
 * @param {boolean} force - Báº¯t buá»™c lÆ°u ngay cáº£ khi stateChanged lÃ  false.
 */
async function saveToGitHub(force = false) {
    // Bá» qua náº¿u khÃ´ng cÃ³ thay Ä‘á»•i vÃ  khÃ´ng Ã©p buá»™c lÆ°u
    if (!stateChanged && !force) return;
    
    // **CHECKPOINT:** TÃ­nh láº¡i báº£ng xáº¿p háº¡ng trÆ°á»›c khi lÆ°u (Ä‘áº£m báº£o dá»¯ liá»‡u ranking lÃ  má»›i nháº¥t)
    tinhVaCapNhatXepHang();

    const cfg = state.config;
    if (!cfg.owner || !cfg.repo || !cfg.token) {
        console.warn("KhÃ´ng thá»ƒ tá»± Ä‘á»™ng lÆ°u: Thiáº¿u cáº¥u hÃ¬nh GitHub.");
        document.getElementById('autoState').className = 'text-warning';
        document.getElementById('autoState').textContent = 'Táº¡m dá»«ng (Thiáº¿u Config)';
        return;
    }

    document.getElementById('autoState').className = 'text-info';
    document.getElementById('autoState').textContent = 'Äang lÆ°u...';
    if (force) {
         updateStatus('configStatus', 'info', 'Äang cáº­p nháº­t dá»¯ liá»‡u lÃªn GitHub...');
    }


    const apiUrl = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${cfg.folder}/${cfg.file}`;
    
    // Chá»‰ lÆ°u cÃ¡c trÆ°á»ng cáº§n thiáº¿t, bao gá»“m cáº£ báº£ng xáº¿p háº¡ng (tableA, tableB)
    const stateToSave = {
        mixedTeams: state.mixedTeams,
        maleTeams: state.maleTeams,
        matchesA: state.matchesA,
        matchesB: state.matchesB,
        courts: state.courts,
        semifinals: state.semifinals,
        final: state.final,
        // **Báº¢NG Xáº¾P Háº NG VÃ’NG Báº¢NG ÄÃƒ TÃNH TOÃN**
        tableA: state.tableA,
        tableB: state.tableB 
    };
    const content = b64EncodeUnicode(JSON.stringify(stateToSave));
    
    try {
        // LuÃ´n fetch SHA má»›i nháº¥t trÆ°á»›c khi cá»‘ gáº¯ng lÆ°u
        const result = await fetchFileSha(cfg, cfg.file); // Láº¥y SHA cá»§a state.json
        const sha = result.sha; 
        
        const payload = {
            message: `${force ? '[Manual-save]' : '[Auto-save]'} Cáº­p nháº­t tráº¡ng thÃ¡i giáº£i Ä‘áº¥u TKD lÃºc ${new Date().toLocaleString('vi-VN')}`,
            content: content
        };
        
        // ThÃªm SHA Ä‘á»ƒ cáº­p nháº­t, náº¿u khÃ´ng cÃ³ SHA sáº½ táº¡o má»›i
        if (sha) {
             payload.sha = sha;
        }

        const response = await fetch(apiUrl, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${cfg.token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            const data = await response.json();
            currentSha = data.content.sha;
            stateChanged = false;
            document.getElementById('lastSaved').textContent = `Láº§n lÆ°u: ${new Date().toLocaleTimeString('vi-VN')}`;
            document.getElementById('autoState').className = 'text-success';
            document.getElementById('autoState').textContent = 'ÄÃ£ LÆ°u';
            if (force) {
                 updateStatus('configStatus', 'success', `Cáº­p nháº­t dá»¯ liá»‡u lÃªn GitHub thÃ nh cÃ´ng lÃºc ${new Date().toLocaleTimeString('vi-VN')}.`);
            }
        } else {
            // Xá»­ lÃ½ lá»—i 409 Conflict
            if (response.status === 409) {
                console.warn("Lá»—i 409 Conflict: Dá»¯ liá»‡u Ä‘Ã£ thay Ä‘á»•i trÃªn GitHub. Äang cá»‘ gáº¯ng láº¥y SHA má»›i.");
                
                await fetchFileSha(cfg, cfg.file); 
                
                document.getElementById('autoState').className = 'text-warning';
                document.getElementById('autoState').textContent = 'Conflict. Sáº½ thá»­ lÆ°u láº¡i sau 30s.';
                if (force) {
                     updateStatus('configStatus', 'warning', `Lá»—i Conflict (Dá»¯ liá»‡u Ä‘Ã£ thay Ä‘á»•i trÃªn GitHub). Vui lÃ²ng thá»­ láº¡i sau 30s.`);
                }
            } else {
                throw new Error(`Lá»—i HTTP: ${response.status} - ${response.statusText}`);
            }
        }
    } catch (error) {
        console.error("Lá»—i khi lÆ°u lÃªn GitHub:", error);
        document.getElementById('autoState').className = 'text-danger';
        document.getElementById('autoState').textContent = 'Lá»—i LÆ°u';
        if (force) {
             updateStatus('configStatus', 'danger', `Lá»—i cáº­p nháº­t lÃªn GitHub: ${error.message}.`);
        }
    }
}

/**
 * Kiá»ƒm tra káº¿t ná»‘i vÃ  Táº£i dá»¯ liá»‡u
 */
async function checkConnection() {
    const cfg = state.config;
    if (!cfg.owner || !cfg.repo || !cfg.token) {
        updateStatus('configStatus', 'warning', 'Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ Owner, Repo vÃ  Token.');
        return;
    }

    try {
        updateStatus('configStatus', 'info', 'Äang kiá»ƒm tra káº¿t ná»‘i tá»›i kho lÆ°u trá»¯...');
        
        const repoCheckUrl = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}`;
        const repoResponse = await fetch(repoCheckUrl, {
            headers: {
                'Authorization': `token ${cfg.token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        if (!repoResponse.ok) {
            throw new Error(`Lá»—i truy cáº­p kho lÆ°u trá»¯. MÃ£: ${repoResponse.status}. (Kiá»ƒm tra Token/Repo/Owner)`);
        }

        updateStatus('configStatus', 'success', 'âœ… Káº¿t ná»‘i GitHub thÃ nh cÃ´ng! Äang tiáº¿n hÃ nh táº£i dá»¯ liá»‡u...');
        await loadFromGitHub();

    } catch (error) {
        updateStatus('configStatus', 'danger', `âŒ Kiá»ƒm tra káº¿t ná»‘i tháº¥t báº¡i: ${error.message}.`);
        console.error("Lá»—i kiá»ƒm tra káº¿t ná»‘i:", error);
    }
}

/**
 * HÃ m Khá»Ÿi Ä‘á»™ng chá»©c nÄƒng Auto-save
 */
function startAutoSave() {
    if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
    }
    document.getElementById('autoState').className = 'text-success';
    document.getElementById('autoState').textContent = 'Äang cháº¡y';
    // Thiáº¿t láº­p interval 30 giÃ¢y (30000ms)
    autoSaveInterval = setInterval(saveToGitHub, 30000); 
}

// --- Cáº¥u hÃ¬nh & Khá»Ÿi táº¡o ---
/**
 * LÆ°u cáº¥u hÃ¬nh káº¿t ná»‘i GitHub vÃ  cÃ¡c cáº¥u hÃ¬nh khÃ¡c vÃ o LocalStorage.
 */
function saveConfig() {
    state.config.owner = document.getElementById('cfgOwner').value.trim();
    state.config.repo = document.getElementById('cfgRepo').value.trim();
    state.config.folder = document.getElementById('cfgFolder').value.trim();
    state.config.file = document.getElementById('cfgFile').value.trim();
    state.config.token = document.getElementById('cfgToken').value.trim();

    // LÆ°u táº¥t cáº£ cáº¥u hÃ¬nh vÃ o LocalStorage
    localStorage.setItem('tkdConfig', JSON.stringify(state.config));
    
    // LÆ°u cáº¥u hÃ¬nh sÃ¢n
    localStorage.setItem('tkdCourts', JSON.stringify(state.courts));

    updateStatus('configStatus', 'success', 'ÄÃ£ lÆ°u cáº¥u hÃ¬nh káº¿t ná»‘i GitHub vÃ o bá»™ nhá»› cá»¥c bá»™ (Local Storage).');
    
    // Khá»Ÿi Ä‘á»™ng láº¡i auto-save náº¿u cáº¥u hÃ¬nh há»£p lá»‡
    if (state.config.owner && state.config.repo && state.config.token) {
        startAutoSave();
    }
}

/**
 * Táº£i cáº¥u hÃ¬nh tá»« LocalStorage.
 */
function loadConfig() {
    const savedConfig = localStorage.getItem('tkdConfig');
    if (savedConfig) {
        state.config = JSON.parse(savedConfig);
        document.getElementById('cfgOwner').value = state.config.owner || '';
        document.getElementById('cfgRepo').value = state.config.repo || '';
        document.getElementById('cfgFolder').value = state.config.folder || 'data';
        document.getElementById('cfgFile').value = state.config.file || 'state.json';
        document.getElementById('cfgToken').value = state.config.token || '';
        
        // Cáº­p nháº­t UI cho preferredCourtType
        const select = document.getElementById('preferredCourtType');
        if (select) {
            select.value = state.config.preferredCourtType || 'mixed';
        }
    }
    
    // Táº£i cáº¥u hÃ¬nh sÃ¢n
    const savedCourts = localStorage.getItem('tkdCourts');
    if (savedCourts) {
        state.courts = JSON.parse(savedCourts);
    }
}

/**
 * Cáº­p nháº­t cáº¥u hÃ¬nh Æ°u tiÃªn sÃ¢n cho tÃ­nh nÄƒng Táº¡o lá»‹ch Tá»‘i Æ°u vÃ  lÆ°u vÃ o LocalStorage.
 */
function updatePreferredCourtType() {
    const select = document.getElementById('preferredCourtType');
    if (select) {
        state.config.preferredCourtType = select.value;
        saveConfig();
        updateStatus('configStatus', 'success', `ÄÃ£ cáº­p nháº­t Æ°u tiÃªn sÃ¢n thÃ nh: ${select.options[select.selectedIndex].text}.`);
    }
}

/**
 * Cáº­p nháº­t tráº¡ng thÃ¡i thÃ´ng bÃ¡o.
 * @param {string} elementId - ID cá»§a div hiá»ƒn thá»‹ tráº¡ng thÃ¡i
 * @param {string} type - loáº¡i alert (success, danger, info, warning)
 * @param {string} message - Ná»™i dung thÃ´ng bÃ¡o
 */
function updateStatus(elementId, type, message) {
    const statusElement = document.getElementById(elementId);
    if (statusElement) {
        statusElement.className = `alert alert-${type} mt-2`;
        statusElement.textContent = message;
        // Tá»± Ä‘á»™ng xÃ³a thÃ´ng bÃ¡o sau 5 giÃ¢y (trá»« configStatus)
        if (elementId !== 'configStatus') {
            setTimeout(() => {
                statusElement.innerHTML = '';
                statusElement.className = '';
            }, 5000);
        }
    }
}

// --- Logic Äiá»ƒm sá»‘ & Xáº¿p háº¡ng VÃ²ng Báº£ng ---

// === START FIX V39: HÃ m updateScore Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a ===
/**
 * Cáº­p nháº­t Ä‘iá»ƒm sá»‘ tráº­n Ä‘áº¥u VÃ²ng Báº£ng vÃ  kÃ­ch hoáº¡t tÃ­nh toÃ¡n láº¡i Báº£ng xáº¿p háº¡ng.
 * @param {string} group - TÃªn báº£ng Ä‘áº¥u ('A' hoáº·c 'B').
 * @param {number} index - Chá»‰ má»¥c (index) cá»§a tráº­n Ä‘áº¥u trong máº£ng.
 */
function updateScore(group, index) {
    // 1. XÃ¡c Ä‘á»‹nh máº£ng tráº­n Ä‘áº¥u
    const matchArray = group === 'A' ? state.matchesA : state.matchesB;
    const match = matchArray[index];

    // 2. Äá»c Ä‘iá»ƒm tá»« input
    const inputA = document.getElementById(`score-${group}-${index}-A`);
    const inputB = document.getElementById(`score-${group}-${index}-B`);

    // 3. FIX CHUYá»‚N Äá»”I: Chuyá»ƒn Ä‘á»•i sang sá»‘ nguyÃªn (base 10) vÃ  xá»­ lÃ½ input rá»—ng
    let scoreA = inputA.value === '' ? null : parseInt(inputA.value, 10);
    let scoreB = inputB.value === '' ? null : parseInt(inputB.value, 10);
    
    // FIX KIá»‚M TRA Há»¢P Lá»†: Äáº·t láº¡i lÃ  null náº¿u giÃ¡ trá»‹ nháº­p vÃ o khÃ´ng pháº£i lÃ  sá»‘ (NaN)
    if (isNaN(scoreA)) scoreA = null;
    if (isNaN(scoreB)) scoreB = null;

    // 4. Cáº­p nháº­t state
    match.scoreA = scoreA;
    match.scoreB = scoreB;
    match.winner = null; // Reset káº¿t quáº£ trÆ°á»›c
    match.loser = null;

    // 5. XÃ¡c Ä‘á»‹nh ngÆ°á»i tháº¯ng cuá»™c chá»‰ khi CÃ“ Äá»¦ VÃ€ Há»¢P Lá»† cáº£ hai Ä‘iá»ƒm sá»‘
    if (scoreA !== null && scoreB !== null) {
        if (scoreA > scoreB) {
            match.winner = match.teamA;
            match.loser = match.teamB;
        } else if (scoreB > scoreA) {
            match.winner = match.teamB;
            match.loser = match.teamA;
        }
        // Náº¿u hÃ²a: match.winner vÃ  match.loser váº«n lÃ  null, coi nhÆ° khÃ´ng cÃ³ káº¿t quáº£ há»£p lá»‡ (Ä‘Ãºng theo luáº­t khÃ´ng hÃ²a)
    }

    // 6. KÃ­ch hoáº¡t Ä‘á»“ng bá»™ hÃ³a
    stateChanged = true;
    
    // BÆ¯á»šC FIX QUAN TRá»ŒNG: Báº¯t buá»™c tÃ­nh toÃ¡n láº¡i báº£ng xáº¿p háº¡ng (fix lá»—i khÃ´ng update ranking)
    tinhVaCapNhatXepHang(); 

    // 7. Cáº­p nháº­t giao diá»‡n
    renderMatchesView(); // Cáº­p nháº­t mÃ u tháº¯ng/thua trong tab VÃ²ng Báº£ng
    renderOverview();    // Cáº­p nháº­t tab Tá»•ng quan (bao gá»“m cáº£ Báº£ng xáº¿p háº¡ng)
}

// === END FIX V39 ===


/**
 * Cáº­p nháº­t Ä‘iá»ƒm sá»‘ tráº­n Ä‘áº¥u VÃ²ng Chung Káº¿t vÃ  kÃ­ch hoáº¡t cáº­p nháº­t Chung káº¿t.
 * @param {string} matchType - 'semifinal' hoáº·c 'final'
 * @param {number} index - Chá»‰ má»¥c (index) cá»§a tráº­n Ä‘áº¥u trong máº£ng (0 hoáº·c 1 cho bÃ¡n káº¿t)
 */
function updateFinalScore(matchType, index) {
    let match;
    let winnerKey = 'winner';
    let loserKey = 'loser';

    if (matchType === 'semifinal') {
        match = state.semifinals[index];
    } else if (matchType === 'final') {
        match = state.final;
        loserKey = 'runnerUp'; // Ã quÃ¢n thay vÃ¬ Loser
    } else {
        return;
    }

    // Äá»c Ä‘iá»ƒm tá»« input vÃ  chuyá»ƒn Ä‘á»•i sang sá»‘ nguyÃªn.
    const inputA = document.getElementById(`score-${match.id}-A`);
    const inputB = document.getElementById(`score-${match.id}-B`);
    
    let scoreA = inputA.value === '' ? null : parseInt(inputA.value, 10);
    let scoreB = inputB.value === '' ? null : parseInt(inputB.value, 10);
    
    // Kiá»ƒm tra NaN
    if (isNaN(scoreA)) scoreA = null;
    if (isNaN(scoreB)) scoreB = null;


    match.scoreA = scoreA;
    match.scoreB = scoreB;
    match[winnerKey] = null; 
    match[loserKey] = null;

    // XÃ¡c Ä‘á»‹nh ngÆ°á»i tháº¯ng cuá»™c
    if (scoreA !== null && scoreB !== null) {
        if (scoreA > scoreB) {
            match[winnerKey] = match.teamA;
            match[loserKey] = match.teamB;
        } else if (scoreB > scoreA) {
            match[winnerKey] = match.teamB;
            match[loserKey] = match.teamA;
        }
    }

    // LuÃ´n Ä‘áº·t cá» thay Ä‘á»•i
    stateChanged = true;
    
    // Cáº­p nháº­t Ä‘á»™i vÃ o vÃ²ng Chung káº¿t/Káº¿t thÃºc giáº£i Ä‘áº¥u
    capNhatDoiVaoVongChungKet(state.tableA, state.tableB);
    
    // Cáº­p nháº­t giao diá»‡n
    renderFinals(); 
    renderOverview();
    renderFinalResults(); 
}

/**
 * TÃ­nh toÃ¡n láº¡i toÃ n bá»™ báº£ng xáº¿p háº¡ng cá»§a cáº£ hai báº£ng Ä‘áº¥u (A vÃ  B).
 * ÄÃ¢y lÃ  hÃ m trung tÃ¢m Ä‘Æ°á»£c gá»i sau má»—i láº§n nháº­p Ä‘iá»ƒm vÃ²ng báº£ng.
 */
function tinhVaCapNhatXepHang() {
    // 1. TÃ­nh toÃ¡n Ä‘iá»ƒm sá»‘ vÃ  hiá»‡u sá»‘ cho tá»«ng Ä‘á»™i
    function calculateTeamStats(teams, matches) {
        const stats = teams.map(teamName => ({
            name: teamName,
            W: 0, // Tháº¯ng
            L: 0, // Thua
            PTS: 0, // Tá»•ng Ä‘iá»ƒm
            GF: 0, // Äiá»ƒm tháº¯ng (Goals For)
            GA: 0, // Äiá»ƒm thua (Goals Against)
            GD: 0, // Hiá»‡u sá»‘ (Goals Difference)
        }));

        matches.forEach(match => {
            if (match.scoreA !== null && match.scoreB !== null) {
                const teamAStat = stats.find(s => s.name === match.teamA);
                const teamBStat = stats.find(s => s.name === match.teamB);

                if (teamAStat && teamBStat) {
                    teamAStat.GF += match.scoreA;
                    teamAStat.GA += match.scoreB;
                    teamBStat.GF += match.scoreB;
                    teamBStat.GA += match.scoreA;

                    if (match.winner === match.teamA) {
                        teamAStat.W += 1;
                        teamAStat.PTS += 3; // 3 Ä‘iá»ƒm cho tráº­n tháº¯ng
                        teamBStat.L += 1;
                    } else if (match.winner === match.teamB) {
                        teamBStat.W += 1;
                        teamBStat.PTS += 3;
                        teamAStat.L += 1;
                    }
                    // TrÆ°á»ng há»£p hÃ²a (khÃ´ng cÃ³ winner/loser) khÃ´ng cá»™ng Ä‘iá»ƒm
                }
            }
        });
        
        // TÃ­nh toÃ¡n Hiá»‡u sá»‘
        stats.forEach(s => {
            s.GD = s.GF - s.GA;
        });

        return stats;
    }

    // 2. Cáº­p nháº­t vÃ  sáº¯p xáº¿p báº£ng A
    let statsA = calculateTeamStats(state.mixedTeams, state.matchesA);
    statsA.sort((a, b) => {
        // 1. Æ¯u tiÃªn: Sá»‘ tráº­n tháº¯ng (W)
        if (b.W !== a.W) return b.W - a.W;
        
        // 2. Æ¯u tiÃªn: Äá»‘i Ä‘áº§u trá»±c tiáº¿p (Head-to-head) - Chá»‰ Ã¡p dá»¥ng náº¿u cÃ³ 2 Ä‘á»™i báº±ng W
        const rankingA = checkHeadToHead(statsA, state.matchesA);
        const rankA = rankingA.findIndex(team => team.name === a.name);
        const rankB = rankingA.findIndex(team => team.name === b.name);
        
        if (rankingA.length > 0 && rankA !== rankB) {
            // Náº¿u Äá»‘i Ä‘áº§u Ä‘Ã£ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c thá»© háº¡ng (rankA, rankB khÃ¡c nhau)
            // Láº¥y káº¿t quáº£ tá»« hÃ m checkHeadToHead Ä‘á»ƒ sáº¯p xáº¿p
            // Náº¿u a xáº¿p trÆ°á»›c b trong rankingA thÃ¬ a - b < 0 (a lÃªn trÆ°á»›c)
            return rankA - rankB; 
        }

        // 3. Æ¯u tiÃªn: Hiá»‡u sá»‘ (GD)
        if (b.GD !== a.GD) return b.GD - a.GD;

        // 4. Æ¯u tiÃªn: Tá»•ng Ä‘iá»ƒm tháº¯ng (GF)
        if (b.GF !== a.GF) return b.GF - a.GF;

        // 5. Æ¯u tiÃªn: Tá»•ng Ä‘iá»ƒm (PTS) (Thá»±c táº¿ khÃ´ng cáº§n thiáº¿t náº¿u Ä‘Ã£ cÃ³ W)
        if (b.PTS !== a.PTS) return b.PTS - a.PTS;
        
        // 6. Ngáº«u nhiÃªn (Náº¿u táº¥t cáº£ chá»‰ sá»‘ báº±ng nhau)
        return 0;
    });
    state.tableA = statsA;

    // 3. Cáº­p nháº­t vÃ  sáº¯p xáº¿p báº£ng B
    let statsB = calculateTeamStats(state.maleTeams, state.matchesB);
    statsB.sort((a, b) => {
        // 1. Æ¯u tiÃªn: Sá»‘ tráº­n tháº¯ng (W)
        if (b.W !== a.W) return b.W - a.W;
        
        // 2. Æ¯u tiÃªn: Äá»‘i Ä‘áº§u trá»±c tiáº¿p (Head-to-head)
        const rankingB = checkHeadToHead(statsB, state.matchesB);
        const rankA = rankingB.findIndex(team => team.name === a.name);
        const rankB = rankingB.findIndex(team => team.name === b.name);
        
        if (rankingB.length > 0 && rankA !== rankB) {
            return rankA - rankB; 
        }

        // 3. Æ¯u tiÃªn: Hiá»‡u sá»‘ (GD)
        if (b.GD !== a.GD) return b.GD - a.GD;

        // 4. Æ¯u tiÃªn: Tá»•ng Ä‘iá»ƒm tháº¯ng (GF)
        if (b.GF !== a.GF) return b.GF - a.GF;

        // 5. Æ¯u tiÃªn: Tá»•ng Ä‘iá»ƒm (PTS)
        if (b.PTS !== a.PTS) return b.PTS - a.PTS;
        
        // 6. Ngáº«u nhiÃªn
        return 0;
    });
    state.tableB = statsB;
    
    // BÆ¯á»šC Äá»’NG Bá»˜ QUAN TRá»ŒNG
    // Tá»± Ä‘á»™ng Ä‘iá»n Ä‘á»™i vÃ o VÃ²ng Chung káº¿t (Náº¿u VÃ²ng Báº£ng Ä‘á»§ Ä‘iá»u kiá»‡n)
    capNhatDoiVaoVongChungKet(state.tableA, state.tableB); 
    
    // Cáº­p nháº­t tab Káº¿t quáº£ Chung cuá»™c
    renderRankingTables(); 
}

/**
 * Logic kiá»ƒm tra Ä‘á»‘i Ä‘áº§u trá»±c tiáº¿p giá»¯a cÃ¡c Ä‘á»™i cÃ³ cÃ¹ng chá»‰ sá»‘ phá»¥ (W).
 * Chá»‰ tráº£ vá» thá»© tá»± xáº¿p háº¡ng cá»§a nhÃ³m Ä‘á»™i báº±ng Ä‘iá»ƒm (W) Ä‘Ã³.
 * @param {Array<object>} stats - Máº£ng thá»‘ng kÃª cá»§a Ä‘á»™i trong báº£ng Ä‘áº¥u.
 * @param {Array<object>} matches - Máº£ng tráº­n Ä‘áº¥u cá»§a báº£ng Ä‘áº¥u Ä‘Ã³.
 * @returns {Array<object>} Máº£ng xáº¿p háº¡ng Ä‘Ã£ tÃ­nh toÃ¡n báº±ng luáº­t Äá»‘i Ä‘áº§u.
 */
function checkHeadToHead(stats, matches) {
    // 1. TÃ¬m nhÃ³m Ä‘á»™i báº±ng chá»‰ sá»‘ quan trá»ng nháº¥t (W)
    const teamsByW = {};
    stats.forEach(s => {
        if (!teamsByW[s.W]) {
            teamsByW[s.W] = [];
        }
        teamsByW[s.W].push(s);
    });

    let finalRanking = [];
    
    // Duyá»‡t qua tá»«ng nhÃ³m Ä‘á»™i báº±ng W (tá»« cao Ä‘áº¿n tháº¥p)
    Object.keys(teamsByW).sort((a, b) => b - a).forEach(w => {
        const group = teamsByW[w];
        
        if (group.length <= 1) {
            finalRanking.push(...group);
            return;
        }

        // 2. Náº¿u cÃ³ 2 Ä‘á»™i trá»Ÿ lÃªn báº±ng W, tÃ­nh Äá»‘i Ä‘áº§u
        const teamNames = group.map(s => s.name);
        let headToHeadStats = group.map(s => ({ 
            name: s.name, 
            W: 0, 
            GD: 0, 
            GF: 0,
            originalW: s.W // Giá»¯ láº¡i W gá»‘c Ä‘á»ƒ xáº¿p sau cÃ¹ng náº¿u Ä‘á»‘i Ä‘áº§u khÃ´ng giáº£i quyáº¿t Ä‘Æ°á»£c
        }));

        // TÃ­nh káº¿t quáº£ Äá»‘i Ä‘áº§u giá»¯a cÃ¡c Ä‘á»™i trong nhÃ³m nÃ y
        matches.forEach(match => {
            const teamAInGroup = teamNames.includes(match.teamA);
            const teamBInGroup = teamNames.includes(match.teamB);

            // Náº¿u tráº­n Ä‘áº¥u diá»…n ra giá»¯a hai Ä‘á»™i trong nhÃ³m Ä‘ang xÃ©t
            if (teamAInGroup && teamBInGroup && match.scoreA !== null && match.scoreB !== null) {
                const statA = headToHeadStats.find(s => s.name === match.teamA);
                const statB = headToHeadStats.find(s => s.name === match.teamB);
                
                if (statA && statB) {
                    statA.GF += match.scoreA;
                    statA.GD += match.scoreA - match.scoreB;
                    statB.GF += match.scoreB;
                    statB.GD += match.scoreB - match.scoreA;

                    if (match.winner === match.teamA) {
                        statA.W += 1;
                    } else if (match.winner === match.teamB) {
                        statB.W += 1;
                    }
                }
            }
        });
        
        // Sáº¯p xáº¿p láº¡i nhÃ³m nÃ y theo luáº­t Äá»‘i Ä‘áº§u: W > GD > GF
        group.sort((a, b) => {
            const h2hA = headToHeadStats.find(s => s.name === a.name);
            const h2hB = headToHeadStats.find(s => s.name === b.name);

            if (!h2hA || !h2hB) return 0;

            // 1. Äá»‘i Ä‘áº§u: Sá»‘ tráº­n tháº¯ng (W)
            if (b.W !== a.W) return b.W - a.W;
            
            // 2. Äá»‘i Ä‘áº§u: Hiá»‡u sá»‘ (GD)
            if (h2hB.GD !== h2hA.GD) return h2hB.GD - h2hA.GD;

            // 3. Äá»‘i Ä‘áº§u: Tá»•ng Ä‘iá»ƒm tháº¯ng (GF)
            if (h2hB.GF !== h2hA.GF) return h2hB.GF - h2hA.GF;
            
            // Náº¿u Ä‘á»‘i Ä‘áº§u váº«n hÃ²a, quay láº¡i dÃ¹ng chá»‰ sá»‘ phá»¥ cá»§a toÃ n giáº£i (GD toÃ n giáº£i)
            if (b.GD !== a.GD) return b.GD - a.GD;
            
            // Sau Ä‘Ã³ lÃ  GF toÃ n giáº£i
            if (b.GF !== a.GF) return b.GF - a.GF;

            return 0;
        });

        finalRanking.push(...group);
    });

    return finalRanking;
}

/**
 * Tá»± Ä‘á»™ng cáº­p nháº­t tÃªn Ä‘á»™i vÃ o VÃ²ng BÃ¡n káº¿t (SF1, SF2) vÃ  Chung káº¿t (F)
 */
function capNhatDoiVaoVongChungKet(tableA, tableB) {
    
    // 1. Kiá»ƒm tra Ä‘iá»u kiá»‡n VÃ²ng Báº£ng
    const totalMatchesA = state.mixedTeams.length * (state.mixedTeams.length - 1) / 2;
    const completedA = state.matchesA.filter(m => m.scoreA !== null && m.scoreB !== null).length;
    const isGroupACompleted = totalMatchesA > 0 && completedA === totalMatchesA;

    const totalMatchesB = state.maleTeams.length * (state.maleTeams.length - 1) / 2;
    const completedB = state.matchesB.filter(m => m.scoreA !== null && m.scoreB !== null).length;
    const isGroupBCompleted = totalMatchesB > 0 && completedB === totalMatchesB;
    
    const isKnockoutStarted = state.semifinals.some(sf => sf.scoreA !== null || sf.scoreB !== null);
    
    // 2. Cáº­p nháº­t VÃ²ng BÃ¡n káº¿t (Chá»‰ khi VÃ²ng Báº£ng hoÃ n thÃ nh vÃ  BÃ¡n káº¿t chÆ°a báº¯t Ä‘áº§u)
    if (isGroupACompleted && isGroupBCompleted && !isKnockoutStarted) {
        const team1A = tableA[0] ? tableA[0].name : 'Nháº¥t A';
        const team2A = tableA[1] ? tableA[1].name : 'NhÃ¬ A';
        const team1B = tableB[0] ? tableB[0].name : 'Nháº¥t B';
        const team2B = tableB[1] ? tableB[1].name : 'NhÃ¬ B';

        // SF1: Nháº¥t A vs NhÃ¬ B (Index 0)
        state.semifinals[0].teamA = team1A;
        state.semifinals[0].teamB = team2B;
        
        // SF2: Nháº¥t B vs NhÃ¬ A (Index 1)
        state.semifinals[1].teamA = team1B;
        state.semifinals[1].teamB = team2A;
    } else if (!isKnockoutStarted) {
        // Reset vá» giÃ¡ trá»‹ máº·c Ä‘á»‹nh náº¿u chÆ°a hoÃ n thÃ nh VÃ²ng Báº£ng vÃ  chÆ°a Ä‘áº¥u BÃ¡n káº¿t
        state.semifinals[0].teamA = 'Nháº¥t A';
        state.semifinals[0].teamB = 'NhÃ¬ B';
        state.semifinals[1].teamA = 'Nháº¥t B';
        state.semifinals[1].teamB = 'NhÃ¬ A';
    }


    // 3. Cáº­p nháº­t Tráº­n Chung káº¿t (Dá»±a trÃªn káº¿t quáº£ BÃ¡n káº¿t)
    const SF1Winner = state.semifinals[0].winner;
    const SF2Winner = state.semifinals[1].winner;
    
    // Cáº­p nháº­t Ä‘á»™i vÃ o Chung káº¿t
    if (SF1Winner) {
        state.final.teamA = SF1Winner;
    } else {
        state.final.teamA = 'Tháº¯ng SF1';
    }
    
    if (SF2Winner) {
        state.final.teamB = SF2Winner;
    } else {
        state.final.teamB = 'Tháº¯ng SF2';
    }
    
    // Cáº­p nháº­t Háº¡ng Ba (2 Ä‘á»™i thua BÃ¡n káº¿t)
    if (state.semifinals.every(sf => sf.loser)) {
        state.thirdPlaceTeams = [state.semifinals[0].loser, state.semifinals[1].loser];
    } else {
        state.thirdPlaceTeams = [];
    }
}

// --- Logic Táº¡o Lá»‹ch vÃ  MÃ´ phá»ng ---

/**
 * Táº£i lá»‹ch cá»‘ Ä‘á»‹nh tá»« biáº¿n FIXED_SCHEDULE_CSV (CalendarTKD30)
 */
function taoLichCoDinh() {
    if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Táº£i lá»‹ch Máº«u (CalendarTKD30)? Lá»‹ch thi Ä‘áº¥u hiá»‡n táº¡i sáº½ bá»‹ ghi Ä‘Ã¨.")) return;
    
    state.matchesA = [];
    state.matchesB = [];
    
    // Parse CSV
    const lines = FIXED_SCHEDULE_CSV.trim().split('\n');
    const headers = lines[0].split(',');
    
    for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        const match = {};
        headers.forEach((header, index) => {
            match[header.trim()] = values[index] ? values[index].trim() : null;
        });

        const newMatch = {
            id: `M${i}`,
            time: match.time,
            court: match.court,
            teamA: match.teamA,
            teamB: match.teamB,
            scoreA: match.scoreA !== null ? parseInt(match.scoreA, 10) : null,
            scoreB: match.scoreB !== null ? parseInt(match.scoreB, 10) : null,
            winner: null,
            loser: null
        };
        
        if (match.bang === 'A') {
            state.matchesA.push(newMatch);
        } else if (match.bang === 'B') {
            state.matchesB.push(newMatch);
        }
    }
    
    // Khá»Ÿi táº¡o láº¡i káº¿t quáº£ winner/loser dá»±a trÃªn Ä‘iá»ƒm sá»‘ (náº¿u cÃ³)
    [...state.matchesA, ...state.matchesB].forEach(match => {
         if (match.scoreA !== null && match.scoreB !== null) {
             if (match.scoreA > match.scoreB) {
                 match.winner = match.teamA;
                 match.loser = match.teamB;
             } else if (match.scoreB > match.scoreA) {
                 match.winner = match.teamB;
                 match.loser = match.teamA;
             }
         }
    });

    stateChanged = true;
    tinhVaCapNhatXepHang();
    renderMatchesView();
    renderOverview();
    showModal('Táº£i lá»‹ch Máº«u', 'ÄÃ£ táº£i lá»‹ch thi Ä‘áº¥u máº«u CalendarTKD30 thÃ nh cÃ´ng.');
}

/**
 * XÃ³a toÃ n bá»™ lá»‹ch thi Ä‘áº¥u (VÃ²ng Báº£ng, BÃ¡n káº¿t, Chung káº¿t)
 */
function clearAllSchedules() {
    if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XÃ“A TOÃ€N Bá»˜ lá»‹ch thi Ä‘áº¥u vÃ  káº¿t quáº£? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.")) return;

    // Reset lá»‹ch vÃ²ng báº£ng
    state.matchesA = [];
    state.matchesB = [];

    // Reset lá»‹ch vÃ  káº¿t quáº£ chung káº¿t
    state.semifinals.forEach(sf => {
        sf.teamA = 'Nháº¥t A'; sf.teamB = 'NhÃ¬ B'; sf.scoreA = null; sf.scoreB = null; sf.winner = null; sf.loser = null;
        if (sf.id === 'SF2') { sf.teamA = 'Nháº¥t B'; sf.teamB = 'NhÃ¬ A'; }
    });
    state.final.teamA = 'Tháº¯ng SF1';
    state.final.teamB = 'Tháº¯ng SF2';
    state.final.scoreA = null;
    state.final.scoreB = null;
    state.final.winner = null;
    state.final.runnerUp = null;
    state.thirdPlaceTeams = [];

    stateChanged = true;
    tinhVaCapNhatXepHang(); // TÃNH láº¡i báº£ng xáº¿p háº¡ng (trá»‘ng)
    renderMatchesView();
    renderFinals();
    renderOverview();
    showModal('XÃ³a Lá»‹ch ThÃ nh cÃ´ng', 'ToÃ n bá»™ lá»‹ch thi Ä‘áº¥u vÃ  káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c xÃ³a.');
    saveToGitHub();
}

/**
 * Äiá»n káº¿t quáº£ VÃ²ng Báº£ng vÃ  VÃ²ng Chung Káº¿t ngáº«u nhiÃªn (chá»‰ Ä‘iá»n cÃ¡c tráº­n chÆ°a Ä‘áº¥u)
 */
function autoFillScores() {
    if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘iá»n káº¿t quáº£ Tá»° Äá»˜NG cho Táº¤T Cáº¢ cÃ¡c tráº­n chÆ°a Ä‘áº¥u (VÃ²ng Báº£ng & Chung káº¿t)?")) return;
    
    let filledCount = 0;
    
    // 1. Äiá»n VÃ²ng Báº£ng
    [...state.matchesA, ...state.matchesB].forEach(match => {
        if (match.scoreA === null || match.scoreB === null) {
            // Äiá»ƒm ngáº«u nhiÃªn (vÃ­ dá»¥: 11-x, x < 11)
            const winnerScore = 11;
            const loserScore = Math.floor(Math.random() * 9) + 2; // Äiá»ƒm thua tá»« 2-10
            
            if (Math.random() > 0.5) { // 50% A tháº¯ng
                match.scoreA = winnerScore;
                match.scoreB = loserScore;
                match.winner = match.teamA;
                match.loser = match.teamB;
            } else { // 50% B tháº¯ng
                match.scoreA = loserScore;
                match.scoreB = winnerScore;
                match.winner = match.teamB;
                match.loser = match.teamA;
            }
            filledCount++;
        }
    });

    // 2. Äiá»n VÃ²ng Chung Káº¿t (Sau khi VÃ²ng Báº£ng Ä‘Ã£ cÃ³ káº¿t quáº£ Ä‘á»ƒ Ä‘iá»n tÃªn Ä‘á»™i)
    tinhVaCapNhatXepHang(); // Äáº£m báº£o tÃªn Ä‘á»™i Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»n vÃ o bÃ¡n káº¿t

    const fillMatch = (match) => {
        if (!match.winner && match.teamA && match.teamB && match.teamA !== 'Tháº¯ng SF1' && match.teamB !== 'Tháº¯ng SF2') {
             // Äiá»ƒm ngáº«u nhiÃªn cho VÃ²ng CK
            const winnerScore = 11;
            const loserScore = Math.floor(Math.random() * 9) + 2;
            
            if (Math.random() > 0.5) { 
                match.scoreA = winnerScore;
                match.scoreB = loserScore;
                match.winner = match.teamA;
                if (match.id === 'F') {
                    match.runnerUp = match.teamB;
                } else {
                    match.loser = match.teamB;
                }
            } else { 
                match.scoreA = loserScore;
                match.scoreB = winnerScore;
                match.winner = match.teamB;
                 if (match.id === 'F') {
                    match.runnerUp = match.teamA;
                } else {
                    match.loser = match.teamA;
                }
            }
            return true;
        }
        return false;
    };
    
    // Äiá»n bÃ¡n káº¿t
    state.semifinals.forEach(sf => {
        if (fillMatch(sf)) filledCount++;
    });
    
    // Cáº­p nháº­t láº¡i tÃªn Ä‘á»™i vÃ o Chung káº¿t
    capNhatDoiVaoVongChungKet(state.tableA, state.tableB);
    
    // Äiá»n chung káº¿t
    if (fillMatch(state.final)) filledCount++;
    
    if (filledCount > 0) {
        stateChanged = true;
        // Báº®T BUá»˜C: TÃ­nh toÃ¡n láº¡i báº£ng xáº¿p háº¡ng (Ä‘á»ƒ cáº­p nháº­t thá»‘ng kÃª)
        tinhVaCapNhatXepHang(); 
        
        // Cáº­p nháº­t giao diá»‡n
        renderMatchesView();
        renderFinals();
        renderOverview();
        
        // LÆ°u ngay láº­p tá»©c
        saveToGitHub(true);
        showModal('Äiá»n Káº¿t quáº£ Tá»± Ä‘á»™ng', `ÄÃ£ Ä‘iá»n ngáº«u nhiÃªn ${filledCount} tráº­n Ä‘áº¥u VÃ²ng Báº£ng vÃ  VÃ²ng Chung Káº¿t.`);
    } else {
        showModal('Äiá»n Káº¿t quáº£ Tá»± Ä‘á»™ng', 'KhÃ´ng cÃ³ tráº­n Ä‘áº¥u nÃ o cáº§n Ä‘iá»n. ToÃ n bá»™ lá»‹ch Ä‘Ã£ hoÃ n thÃ nh.');
    }
}

/**
 * XÃ³a káº¿t quáº£ VÃ²ng Báº£ng theo Group (A hoáº·c B)
 * @param {string} group - 'A', 'B', hoáº·c 'ALL'
 */
function clearGroupScores(group) {
    // KhÃ´ng cho phÃ©p xÃ³a náº¿u VÃ²ng Chung Káº¿t Ä‘Ã£ cÃ³ káº¿t quáº£
    const finalsCompleted = state.semifinals.some(sf => sf.winner) || state.final.winner;
    if (finalsCompleted) {
        showModal('Lá»—i XÃ³a Káº¿t Quáº£', 'KhÃ´ng thá»ƒ xÃ³a káº¿t quáº£ VÃ²ng Báº£ng. Vui lÃ²ng **XÃ³a káº¿t quáº£ VÃ²ng BÃ¡n káº¿t vÃ  Chung káº¿t** (vÃ­ dá»¥, báº±ng cÃ¡ch xÃ³a toÃ n bá»™ lá»‹ch á»Ÿ tab Cáº¥u hÃ¬nh) trÆ°á»›c.');
        return;
    }
    
    const message = group === 'ALL' 
        ? "Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XÃ“A TOÃ€N Bá»˜ káº¿t quáº£ VÃ²ng Báº£ng (Báº£ng A & B)? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c."
        : `Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XÃ“A TOÃ€N Bá»˜ káº¿t quáº£ cá»§a Báº£ng ${group}? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.`;
    
    if (!confirm(message)) return;

    let clearedCount = 0;
    
    const matchesToClear = [];
    if (group === 'A' || group === 'ALL') matchesToClear.push(...state.matchesA);
    if (group === 'B' || group === 'ALL') matchesToClear.push(...state.matchesB);
    
    matchesToClear.forEach(match => {
        if (match.scoreA !== null || match.scoreB !== null) {
            match.scoreA = null;
            match.scoreB = null;
            match.winner = null;
            match.loser = null;
            clearedCount++;
        }
    });

    if (clearedCount > 0) {
        tinhVaCapNhatXepHang();
        renderMatchesView();
        renderOverview();
        
        stateChanged = true;
        saveToGitHub();
        updateStatus('clearScoreStatus', 'success', `ÄÃ£ xÃ³a ${clearedCount} káº¿t quáº£ tráº­n Ä‘áº¥u VÃ²ng Báº£ng.`);
    } else {
        updateStatus('clearScoreStatus', 'warning', 'KhÃ´ng cÃ³ káº¿t quáº£ nÃ o Ä‘á»ƒ xÃ³a trong báº£ng nÃ y.');
    }
}


// --- Logic SÃ¢n thi Ä‘áº¥u ---

/**
 * Má»Ÿ modal thÃªm/sá»­a sÃ¢n vÃ  Ä‘iá»n dá»¯ liá»‡u náº¿u lÃ  cháº¿ Ä‘á»™ sá»­a.
 * @param {number | null} index - Chá»‰ sá»‘ cá»§a sÃ¢n cáº§n sá»­a, hoáº·c null náº¿u thÃªm má»›i.
 */
function openCourtModal(index = null) {
    const modal = new bootstrap.Modal(document.getElementById('courtModal'));
    document.getElementById('courtFormStatus').innerHTML = '';
    document.getElementById('courtIndex').value = index !== null ? index : '';
    document.getElementById('courtModalLabel').textContent = index !== null ? 'Sá»­a Cáº¥u hÃ¬nh SÃ¢n' : 'ThÃªm SÃ¢n Má»›i';

    if (index !== null) {
        const court = state.courts[index];
        document.getElementById('courtName').value = court.name;
        document.getElementById('courtStartTime').value = court.startTime;
        document.getElementById('courtMaxDuration').value = court.maxDurationMinutes;
        document.getElementById('courtIsMixed').checked = court.isMixed;
    } else {
        document.getElementById('courtForm').reset();
        document.getElementById('courtStartTime').value = '14:00'; // Set default
    }
    modal.show();
}

/**
 * LÆ°u thay Ä‘á»•i cáº¥u hÃ¬nh SÃ¢n.
 */
function saveCourtChanges() {
    const index = document.getElementById('courtIndex').value;
    const name = document.getElementById('courtName').value.trim();
    const startTime = document.getElementById('courtStartTime').value;
    const maxDuration = parseInt(document.getElementById('courtMaxDuration').value, 10);
    const isMixed = document.getElementById('courtIsMixed').checked;
    
    if (!name || !startTime || isNaN(maxDuration) || maxDuration <= 0) {
        updateStatus('courtFormStatus', 'danger', 'Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ vÃ  chÃ­nh xÃ¡c cÃ¡c thÃ´ng tin.');
        return;
    }

    if (index !== '') {
        // Sá»­a
        state.courts[parseInt(index, 10)] = { name, startTime, maxDurationMinutes: maxDuration, isMixed };
        updateStatus('configStatus', 'success', `ÄÃ£ cáº­p nháº­t cáº¥u hÃ¬nh SÃ¢n ${name}.`);
    } else {
        // ThÃªm má»›i
        state.courts.push({ name, startTime, maxDurationMinutes: maxDuration, isMixed });
        updateStatus('configStatus', 'success', `ÄÃ£ thÃªm SÃ¢n ${name} má»›i.`);
    }

    // LÆ°u vÃ  Render láº¡i
    saveConfig(); 
    renderCourtList();
    
    // ÄÃ³ng modal
    const modalElement = document.getElementById('courtModal');
    const modal = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
    modal.hide();
}

/**
 * XÃ³a cáº¥u hÃ¬nh sÃ¢n theo index.
 * @param {number} index - Chá»‰ sá»‘ cá»§a sÃ¢n cáº§n xÃ³a.
 */
function deleteCourt(index) {
    const courtName = state.courts[index].name;
    if (confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a SÃ¢n ${courtName}?`)) {
        state.courts.splice(index, 1);
        saveConfig();
        renderCourtList();
        updateStatus('configStatus', 'success', `ÄÃ£ xÃ³a SÃ¢n ${courtName}.`);
    }
}

/**
 * Táº£i cáº¥u hÃ¬nh SÃ¢n máº·c Ä‘á»‹nh.
 */
function loadDefaultCourtConfig() {
     if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n táº£i láº¡i cáº¥u hÃ¬nh SÃ¢n máº·c Ä‘á»‹nh (8 sÃ¢n)? Cáº¥u hÃ¬nh hiá»‡n táº¡i sáº½ bá»‹ ghi Ä‘Ã¨.")) return;
     state.courts = [
        { name: 'SÃ¢n 1', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
        { name: 'SÃ¢n 2', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
        { name: 'SÃ¢n 3', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
        { name: 'SÃ¢n 4', startTime: '14:00', maxDurationMinutes: 180, isMixed: true }, 
        { name: 'SÃ¢n 5', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
        { name: 'SÃ¢n 6', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
        { name: 'SÃ¢n 7', startTime: '14:00', maxDurationMinutes: 180, isMixed: false }, 
        { name: 'SÃ¢n 8', startTime: '14:00', maxDurationMinutes: 180, isMixed: false } 
    ];
    saveConfig();
    renderCourtList();
    updateStatus('configStatus', 'success', 'ÄÃ£ táº£i cáº¥u hÃ¬nh SÃ¢n máº·c Ä‘á»‹nh (8 sÃ¢n) thÃ nh cÃ´ng.');
}

/**
 * Hiá»ƒn thá»‹ danh sÃ¡ch sÃ¢n dÆ°á»›i dáº¡ng báº£ng vá»›i nÃºt Sá»­a/XÃ³a.
 */
function renderCourtList() {
    const container = document.getElementById('courtListContainer');
    if (!container) return;

    if (state.courts.length === 0) {
        container.innerHTML = `<div class="alert alert-warning">ChÆ°a cÃ³ sÃ¢n nÃ o Ä‘Æ°á»£c cáº¥u hÃ¬nh.</div>`;
        return;
    }

    let html = `<div class='table-responsive'><table class='table table-striped table-sm'> 
        <thead> 
            <tr> 
                <th>TÃªn SÃ¢n</th> 
                <th>Giá» Báº¯t Äáº§u</th> 
                <th>Thá»i LÆ°á»£ng Max (PhÃºt)</th> 
                <th>PhÃ¢n Loáº¡i</th> 
                <th class="text-center">HÃ nh Ä‘á»™ng</th> 
            </tr> 
        </thead> 
        <tbody>`;

    state.courts.forEach((court, index) => {
        const type = court.isMixed ? 'Báº£ng A (Nam - Ná»¯)' : 'Báº£ng B (Nam)';
        const typeClass = court.isMixed ? 'badge bg-primary' : 'badge bg-info';
        html += `<tr> 
            <td>${court.name}</td> 
            <td>${court.startTime}</td> 
            <td>${court.maxDurationMinutes}</td> 
            <td><span class="${typeClass}">${type}</span></td> 
            <td class="text-center"> 
                <button class="btn btn-sm btn-outline-secondary me-1" onclick="openCourtModal(${index})">Sá»­a</button> 
                <button class="btn btn-sm btn-outline-danger" onclick="deleteCourt(${index})">XÃ³a</button> 
            </td> 
        </tr>`;
    });

    html += `</tbody></table></div>`;
    container.innerHTML = html;
}

function renderConfig() {
    // Chá»‰ cáº§n hiá»ƒn thá»‹ cáº¥u hÃ¬nh sÃ¢n hiá»‡n táº¡i
    renderCourtList();
    document.getElementById('courtConfigStatus').innerHTML = '';
    document.getElementById('clearScoreStatus').innerHTML = ''; // Clear new status div

    // Cáº­p nháº­t UI cho preferredCourtType khi vÃ o tab config
    const select = document.getElementById('preferredCourtType');
    if (select) {
        select.value = state.config.preferredCourtType || 'mixed';
    }
}

// --- Logic Rendering ---

/**
 * Render lá»‹ch thi Ä‘áº¥u VÃ²ng Báº£ng theo cháº¿ Ä‘á»™ Ä‘Ã£ chá»n (Table/Court)
 */
function renderMatchesView() {
    const viewMode = document.getElementById('viewMode').value;
    const container = document.getElementById('matchesViewContent');

    if (viewMode === 'table') {
        renderMatchesByTable(container);
    } else {
        renderMatchesByCourt(container);
    }
}

/**
 * Render lá»‹ch thi Ä‘áº¥u VÃ²ng Báº£ng theo Báº£ng Ä‘áº¥u (Group)
 */
function renderMatchesByTable(container) {
    let finalHtml = '';
    
    // Duyá»‡t qua tá»«ng báº£ng Ä‘áº¥u
    [['A', state.matchesA], ['B', state.matchesB]].forEach(([group, matches]) => {
        const teams = group === 'A' ? state.mixedTeams : state.maleTeams;
        if (matches.length === 0 || teams.length < 2) {
            finalHtml += `<h6 class="mt-4">Báº£ng ${group} (${group === 'A' ? 'Nam - Ná»¯' : 'Nam'})</h6>
                          <div class="alert alert-info">ChÆ°a cÃ³ lá»‹ch thi Ä‘áº¥u hoáº·c thiáº¿u Ä‘á»™i.</div>`;
            return;
        }

        finalHtml += `<h6 class="mt-4">Báº£ng ${group} (${group === 'A' ? 'Nam - Ná»¯' : 'Nam'})</h6>
            <div class='table-responsive'><table class='table table-striped table-hover table-bordered table-sm'>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Thá»i gian/SÃ¢n</th>
                        <th>Äá»™i A</th>
                        <th class="text-center">Tá»‰ sá»‘ A</th>
                        <th class="text-center">Tá»‰ sá»‘ B</th>
                        <th>Äá»™i B</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        matches.forEach((match, index) => {
            const teamA_Class = match.winner === match.teamA ? 'winner' : (match.loser === match.teamA ? 'loser' : '');
            const teamB_Class = match.winner === match.teamB ? 'winner' : (match.loser === match.teamB ? 'loser' : '');
            const matchRowClass = match.winner ? 'table-light' : '';
            
            finalHtml += `
                <tr class="${matchRowClass}">
                    <td>${match.id}</td>
                    <td>${match.time || '-'} - ${match.court || '-'}</td>
                    <td class="text-truncate ${teamA_Class}">${match.teamA}</td>
                    <td class="match-score-cell text-center">
                        <input type="number" id="score-${group}-${index}-A" 
                            value="${match.scoreA !== null ? match.scoreA : ''}" 
                            min="0" onchange="updateScore('${group}', ${index})">
                    </td>
                    <td class="match-score-cell text-center">
                        <input type="number" id="score-${group}-${index}-B" 
                            value="${match.scoreB !== null ? match.scoreB : ''}" 
                            min="0" onchange="updateScore('${group}', ${index})">
                    </td>
                    <td class="text-truncate ${teamB_Class}">${match.teamB}</td>
                </tr>
            `;
        });
        
        finalHtml += `
                </tbody>
            </table>
            </div>
        `;
    });

    container.innerHTML = finalHtml;
}

/**
 * Render lá»‹ch thi Ä‘áº¥u VÃ²ng Báº£ng theo SÃ¢n (Court)
 */
function renderMatchesByCourt(container) {
    const allMatches = [...state.matchesA.map(m => ({ ...m, group: 'A' })), 
                        ...state.matchesB.map(m => ({ ...m, group: 'B' }))];
                        
    // Sáº¯p xáº¿p theo thá»i gian vÃ  sau Ä‘Ã³ theo sÃ¢n
    allMatches.sort((a, b) => {
        if (a.time < b.time) return -1;
        if (a.time > b.time) return 1;
        if (a.court < b.court) return -1;
        if (a.court > b.court) return 1;
        return 0;
    });

    // Gom nhÃ³m theo Giá» Báº¯t Ä‘áº§u
    const matchesByTime = allMatches.reduce((acc, match) => {
        const key = match.time || 'ChÆ°a xáº¿p lá»‹ch';
        if (!acc[key]) {
            acc[key] = [];
        }
        acc[key].push(match);
        return acc;
    }, {});
    
    let finalHtml = '';
    
    // Duyá»‡t qua tá»«ng nhÃ³m giá»
    Object.keys(matchesByTime).sort().forEach(time => {
        const matchesAtTime = matchesByTime[time];
        
        finalHtml += `<h6 class="mt-4">Thá»i gian: ${time}</h6>
            <div class='table-responsive'><table class='table table-striped table-hover table-bordered table-sm'>
                <thead>
                    <tr>
                        <th>SÃ¢n</th>
                        <th>Báº£ng</th>
                        <th>Äá»™i A</th>
                        <th class="text-center">Tá»‰ sá»‘ A</th>
                        <th class="text-center">Tá»‰ sá»‘ B</th>
                        <th>Äá»™i B</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        // Sáº¯p xáº¿p theo SÃ¢n
        matchesAtTime.sort((a, b) => {
            if (a.court < b.court) return -1;
            if (a.court > b.court) return 1;
            return 0;
        });

        matchesAtTime.forEach(match => {
            // Cáº§n tÃ¬m index gá»‘c Ä‘á»ƒ gá»i updateScore
            const groupMatches = match.group === 'A' ? state.matchesA : state.matchesB;
            const index = groupMatches.findIndex(m => m.id === match.id);
            
            const teamA_Class = match.winner === match.teamA ? 'winner' : (match.loser === match.teamA ? 'loser' : '');
            const teamB_Class = match.winner === match.teamB ? 'winner' : (match.loser === match.teamB ? 'loser' : '');
            const matchRowClass = match.winner ? 'table-light' : '';
            
            finalHtml += `
                <tr class="${matchRowClass}">
                    <td>${match.court || '-'}</td>
                    <td>${match.group}</td>
                    <td class="text-truncate ${teamA_Class}">${match.teamA}</td>
                    <td class="match-score-cell text-center">
                        <input type="number" id="score-${match.group}-${index}-A" 
                            value="${match.scoreA !== null ? match.scoreA : ''}" 
                            min="0" onchange="updateScore('${match.group}', ${index})">
                    </td>
                    <td class="match-score-cell text-center">
                        <input type="number" id="score-${match.group}-${index}-B" 
                            value="${match.scoreB !== null ? match.scoreB : ''}" 
                            min="0" onchange="updateScore('${match.group}', ${index})">
                    </td>
                    <td class="text-truncate ${teamB_Class}">${match.teamB}</td>
                </tr>
            `;
        });
        
        finalHtml += `
                </tbody>
            </table>
            </div>
        `;
    });

    container.innerHTML = finalHtml;
}

/**
 * Render báº£ng xáº¿p háº¡ng VÃ²ng Báº£ng
 */
function renderRankingTables() {
    const container = document.getElementById('rankingTables');
    if (!container) return;
    
    function createRankingTable(title, tableData) {
        if (tableData.length === 0) {
            return `<div class="p-3 border rounded bg-light"><h6>${title}</h6><p class="text-muted small mb-0">ChÆ°a cÃ³ dá»¯ liá»‡u Ä‘á»™i hoáº·c chÆ°a cÃ³ káº¿t quáº£.</p></div>`;
        }

        let html = `
            <div class="table-responsive">
            <h6>${title}</h6>
            <table class="table table-sm table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Äá»™i</th>
                        <th title="Sá»‘ tráº­n Tháº¯ng/Thua">T/B</th>
                        <th title="Hiá»‡u sá»‘ Ä‘iá»ƒm">HS</th>
                        <th title="Tá»•ng Ä‘iá»ƒm tháº¯ng">ÄT</th>
                        <th title="Tá»•ng Ä‘iá»ƒm">Ä</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        tableData.forEach((team, index) => {
            const rank = index + 1;
            // Highlight Ä‘á»™i Ä‘i tiáº¿p (Háº¡ng 1 & 2)
            const rowClass = rank <= 2 ? 'table-success' : ''; 
            
            html += `
                <tr class="${rowClass}">
                    <td>${rank}</td>
                    <td class="text-truncate">${team.name}</td>
                    <td>${team.W}/${team.L}</td>
                    <td>${team.GD > 0 ? '+' : ''}${team.GD}</td>
                    <td>${team.GF}</td>
                    <td>${team.PTS}</td>
                </tr>
            `;
        });
        
        html += `
                </tbody>
            </table>
            </div>
        `;
        return html;
    }
    
    const tableA = createRankingTable('Báº£ng A (Nam - Ná»¯)', state.tableA);
    const tableB = createRankingTable('Báº£ng B (Nam)', state.tableB);
    
    container.innerHTML = tableA + tableB;
}

/**
 * Render cÃ¡c tráº­n Ä‘áº¥u VÃ²ng Chung Káº¿t (BÃ¡n káº¿t vÃ  Chung káº¿t)
 */
function renderFinals() {
    const semiContainer = document.getElementById('semifinalMatches');
    const finalContainer = document.getElementById('finalMatch');
    
    if (!semiContainer || !finalContainer) return;

    function renderMatch(match, isFinal = false) {
        let matchHtml = ``;
        let group = match.id;
        let winnerClassA = '';
        let winnerClassB = '';
        
        if (match.winner) {
            winnerClassA = match.winner === match.teamA ? 'winner' : 'loser';
            winnerClassB = match.winner === match.teamB ? 'winner' : 'loser';
        }

        // TÃ¬m index trong máº£ng semifinals (0 hoáº·c 1) náº¿u khÃ´ng pháº£i chung káº¿t
        const matchIndex = isFinal ? 0 : state.semifinals.findIndex(sf => sf.id === match.id);
        const onchangeCall = isFinal ? `updateFinalScore('final', 0)` : `updateFinalScore('semifinal', ${matchIndex})`;
        const teamAName = match.teamA || 'Äang chá»';
        const teamBName = match.teamB || 'Äang chá»';
        const isSeeded = teamAName.includes('Nháº¥t') || teamAName.includes('Tháº¯ng');
        
        matchHtml = `
            <div class='card mb-3 ${match.winner ? 'shadow-sm border-success' : 'border-light'}'>
                <div class='card-body p-3'>
                    <div class="row align-items-center g-2">
                        <div class="col-12 col-md-3 text-muted small">${match.time} | ${match.court}</div>
                        
                        <div class="col-12 col-md-4">
                            <span class="${winnerClassA} text-truncate ${isSeeded ? 'text-muted' : ''}">${teamAName}</span> 
                        </div>
                        <div class="col-12 col-md-1 d-flex justify-content-center">
                            <input type="number" class="form-control form-control-sm text-center" 
                                id="score-${group}-A" value="${match.scoreA !== null ? match.scoreA : ''}" min="0" 
                                onchange="${onchangeCall}" style="width: 50px;">
                        </div>
                        
                        <div class="col-12 col-md-1 text-center small">VS</div>
                        
                        <div class="col-12 col-md-1 d-flex justify-content-center">
                            <input type="number" class="form-control form-control-sm text-center" 
                                id="score-${group}-B" value="${match.scoreB !== null ? match.scoreB : ''}" min="0" 
                                onchange="${onchangeCall}" style="width: 50px;">
                        </div>
                        <div class="col-12 col-md-3">
                            <span class="${winnerClassB} text-truncate ${isSeeded ? 'text-muted' : ''}">${teamBName}</span>
                        </div>
                        
                    </div>
                </div>
            </div>
        `;
        return matchHtml;
    }
    
    // Render BÃ¡n káº¿t
    semiContainer.innerHTML = state.semifinals.map(sf => renderMatch(sf, false)).join('');

    // Render Chung káº¿t
    finalContainer.innerHTML = renderMatch(state.final, true);
}

/**
 * Render thÃ´ng tin Tá»•ng quan vÃ  Báº£ng xáº¿p háº¡ng VÃ²ng Báº£ng rÃºt gá»n
 */
function renderOverview() {
    const container = document.getElementById('overviewContent');
    if (!container) return;

    // 1. Tá»•ng quan tÃ¬nh tráº¡ng
    const totalMatchesA = state.mixedTeams.length * (state.mixedTeams.length - 1) / 2;
    const completedA = state.matchesA.filter(m => m.scoreA !== null && m.scoreB !== null).length;
    const isGroupACompleted = totalMatchesA > 0 && completedA === totalMatchesA;
    const percentA = totalMatchesA > 0 ? (completedA / totalMatchesA * 100).toFixed(0) : 0;
    
    const totalMatchesB = state.maleTeams.length * (state.maleTeams.length - 1) / 2;
    const completedB = state.matchesB.filter(m => m.scoreA !== null && m.scoreB !== null).length;
    const isGroupBCompleted = totalMatchesB > 0 ? completedB === totalMatchesB : false;
    const percentB = totalMatchesB > 0 ? (completedB / totalMatchesB * 100).toFixed(0) : 0;
    
    // VÃ²ng Chung káº¿t
    const sf1Winner = state.semifinals[0].winner;
    const sf2Winner = state.semifinals[1].winner;
    let finalStatus = '';
    if (state.final.winner) {
        finalStatus = `<span class="badge bg-success">ÄÃƒ Káº¾T THÃšC (VÃ´ Ä‘á»‹ch: ${state.final.winner})</span>`;
    } else if (sf1Winner && sf2Winner) {
        finalStatus = `<span class="badge bg-warning text-dark">Chá» Chung káº¿t</span>`;
    } else if (isGroupACompleted && isGroupBCompleted) {
         finalStatus = `<span class="badge bg-info text-dark">Chá» BÃ¡n káº¿t</span>`;
    } else {
        finalStatus = `<span class="badge bg-secondary">Chá» VÃ²ng Báº£ng</span>`;
    }
    
    let infoHtml = `
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card p-3 h-100">
                    <h5 class="card-title">Tiáº¿n trÃ¬nh VÃ²ng Báº£ng</h5>
                    <p class="mb-1 small">Báº£ng A (Nam - Ná»¯): ${completedA}/${totalMatchesA} tráº­n hoÃ n thÃ nh 
                        <span class="badge bg-${isGroupACompleted ? 'success' : 'primary'}">${percentA}%</span></p>
                    <p class="mb-1 small">Báº£ng B (Nam): ${completedB}/${totalMatchesB} tráº­n hoÃ n thÃ nh 
                        <span class="badge bg-${isGroupBCompleted ? 'success' : 'primary'}">${percentB}%</span></p>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                 <div class="card p-3 h-100">
                    <h5 class="card-title">Tráº¡ng thÃ¡i VÃ²ng Chung káº¿t</h5>
                    <p class="mb-1">Tráº¡ng thÃ¡i: ${finalStatus}</p>
                    <p class="mb-0 small">BÃ¡n káº¿t 1: ${state.semifinals[0].teamA} vs ${state.semifinals[0].teamB} (${sf1Winner ? 'Tháº¯ng: ' + sf1Winner : 'ChÆ°a Ä‘áº¥u'})</p>
                    <p class="mb-0 small">BÃ¡n káº¿t 2: ${state.semifinals[1].teamA} vs ${state.semifinals[1].teamB} (${sf2Winner ? 'Tháº¯ng: ' + sf2Winner : 'ChÆ°a Ä‘áº¥u'})</p>
                </div>
            </div>
        </div>
        
        <h5 class="mb-3">Báº£ng Xáº¿p Háº¡ng Hiá»‡n Táº¡i (Top 2)</h5>
        <div id="overviewRanking" class="ranking-container">
            ${renderSimpleRanking(state.tableA, 'Báº£ng A')}
            ${renderSimpleRanking(state.tableB, 'Báº£ng B')}
        </div>
    `;
    
    container.innerHTML = infoHtml;
}

/**
 * Táº¡o báº£ng xáº¿p háº¡ng rÃºt gá»n (Top 2) cho tab Tá»•ng quan
 */
function renderSimpleRanking(tableData, title) {
    if (tableData.length === 0) {
        return `<div class="p-3 border rounded bg-light"><h6>${title}</h6><p class="text-muted small mb-0">ChÆ°a cÃ³ dá»¯ liá»‡u Ä‘á»™i.</p></div>`;
    }

    let html = `
        <div class="table-responsive">
        <h6>${title}</h6>
        <table class="table table-sm table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Äá»™i</th>
                    <th title="Sá»‘ tráº­n Tháº¯ng">T</th>
                    <th title="Hiá»‡u sá»‘ Ä‘iá»ƒm">HS</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    // Chá»‰ láº¥y Top 2
    tableData.slice(0, 2).forEach((team, index) => {
        const rank = index + 1;
        html += `
            <tr class="table-success">
                <td>${rank}</td>
                <td class="text-truncate">${team.name}</td>
                <td>${team.W}</td>
                <td>${team.GD > 0 ? '+' : ''}${team.GD}</td>
            </tr>
        `;
    });
    
    // ThÃªm cÃ¡c Ä‘á»™i cÃ²n láº¡i náº¿u cÃ³
    tableData.slice(2).forEach((team, index) => {
         const rank = index + 3;
         html += `
            <tr>
                <td>${rank}</td>
                <td class="text-truncate">${team.name}</td>
                <td>${team.W}</td>
                <td>${team.GD > 0 ? '+' : ''}${team.GD}</td>
            </tr>
        `;
    });

    html += `
            </tbody>
        </table>
        </div>
    `;
    return html;
}

/**
 * Render káº¿t quáº£ Chung cuá»™c (VÃ´ Ä‘á»‹ch, Ã quÃ¢n, Háº¡ng Ba)
 */
function renderFinalResults() {
    const championEl = document.getElementById('champion');
    const runnerUpEl = document.getElementById('runnerUp');
    const thirdPlaceEl = document.getElementById('thirdPlace');
    
    let championText = 'Äang chá» káº¿t quáº£...';
    let runnerUpText = 'Äang chá» káº¿t quáº£...';
    let thirdPlaceText = 'Äang chá» káº¿t quáº£...';
    
    if (state.final.winner) {
        championText = `VÃ´ Ä‘á»‹ch: ğŸ¥‡ **${state.final.winner}**`;
    }
    
    if (state.final.runnerUp) {
        runnerUpText = `Ã quÃ¢n: ğŸ¥ˆ **${state.final.runnerUp}**`;
    }
    
    if (state.thirdPlaceTeams && state.thirdPlaceTeams.length === 2) {
        thirdPlaceText = `Háº¡ng Ba Äá»“ng Háº¡ng: ğŸ¥‰ **${state.thirdPlaceTeams[0]}** vÃ  **${state.thirdPlaceTeams[1]}**`;
    } else if (state.semifinals.some(sf => sf.loser)) {
         thirdPlaceText = `Háº¡ng Ba Äá»“ng Háº¡ng: Äang chá» hoÃ n táº¥t VÃ²ng BÃ¡n káº¿t...`;
    }
    
    championEl.innerHTML = championText;
    runnerUpEl.innerHTML = runnerUpText;
    thirdPlaceEl.innerHTML = thirdPlaceText;
}


// --- Logic Táº¡o Lá»‹ch Tá»‘i Æ°u (Complex) ---

/**
 * Chuyá»ƒn Ä‘á»•i HH:mm thÃ nh sá»‘ phÃºt tá»« 00:00
 */
function timeToMinutes(time) {
    const [h, m] = time.split(':').map(Number);
    return h * 60 + m;
}

/**
 * Chuyá»ƒn Ä‘á»•i sá»‘ phÃºt thÃ nh HH:mm
 */
function minutesToTime(minutes) {
    const h = Math.floor(minutes / 60).toString().padStart(2, '0');
    const m = (minutes % 60).toString().padStart(2, '0');
    return `${h}:${m}`;
}

/**
 * Thuáº­t toÃ¡n táº¡o lá»‹ch thi Ä‘áº¥u tá»‘i Æ°u (Ã­t thá»i gian trá»‘ng, sá»­ dá»¥ng tá»‘i Ä‘a sÃ¢n)
 */
function taoLichThiDauCungGio() {
    if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Tá»± Ä‘á»™ng táº¡o lá»‹ch thi Ä‘áº¥u Tá»‘i Æ°u? Lá»‹ch thi Ä‘áº¥u hiá»‡n táº¡i sáº½ bá»‹ ghi Ä‘Ã¨.")) return;
    
    // 1. Kiá»ƒm tra Ä‘iá»u kiá»‡n
    if (state.mixedTeams.length < 2 && state.maleTeams.length < 2) {
        showModal('Lá»—i Táº¡o Lá»‹ch', 'KhÃ´ng thá»ƒ táº¡o lá»‹ch. Cáº§n Ã­t nháº¥t 2 Ä‘á»™i cho má»—i báº£ng Ä‘áº¥u (hoáº·c nháº­p Ä‘á»™i vÃ o players.json).');
        return;
    }
    if (state.courts.length === 0) {
        showModal('Lá»—i Táº¡o Lá»‹ch', 'KhÃ´ng thá»ƒ táº¡o lá»‹ch. Vui lÃ²ng cáº¥u hÃ¬nh SÃ¢n thi Ä‘áº¥u táº¡i tab Cáº¥u hÃ¬nh.');
        return;
    }
    
    // 2. Khá»Ÿi táº¡o
    state.matchesA = [];
    state.matchesB = [];
    stateChanged = true;

    const allTeams = [...state.mixedTeams, ...state.maleTeams];
    const totalMatchesA = state.mixedTeams.length * (state.mixedTeams.length - 1) / 2;
    const totalMatchesB = state.maleTeams.length * (state.maleTeams.length - 1) / 2;

    const matchesToSchedule = [];

    // Táº¡o danh sÃ¡ch cÃ¡c cáº·p Ä‘áº¥u cáº§n thiáº¿t
    function generateMatchPairs(teams, group) {
        const matches = [];
        for (let i = 0; i < teams.length; i++) {
            for (let j = i + 1; j < teams.length; j++) {
                matches.push({ teamA: teams[i], teamB: teams[j], group: group });
            }
        }
        return matches;
    }

    // 3. Táº¡o táº¥t cáº£ cáº·p Ä‘áº¥u cáº§n xáº¿p
    const matchesA = generateMatchPairs(state.mixedTeams, 'A');
    const matchesB = generateMatchPairs(state.maleTeams, 'B');
    let allPairs = [...matchesA, ...matchesB];
    
    // 4. Khá»Ÿi táº¡o tráº¡ng thÃ¡i SÃ¢n
    const courtStates = state.courts.map(court => ({
        ...court,
        // Thá»i gian sÃ¢n káº¿t thÃºc tráº­n Ä‘áº¥u hiá»‡n táº¡i
        currentMinutes: timeToMinutes(court.startTime),
        // Lá»‹ch Ä‘Ã£ xáº¿p trÃªn sÃ¢n nÃ y
        schedule: []
    }));
    
    // 5. Thuáº­t toÃ¡n Xáº¿p lá»‹ch (Æ¯u tiÃªn SÃ¢n sá»›m nháº¥t)
    const matchDuration = 15; // Giáº£ sá»­ má»—i tráº­n kÃ©o dÃ i 15 phÃºt
    let matchIdCounter = 1;
    let scheduledMatchesCount = 0;

    // Láº·p cho Ä‘áº¿n khi háº¿t tráº­n Ä‘áº¥u cáº§n xáº¿p
    while (allPairs.length > 0 && scheduledMatchesCount < totalMatchesA + totalMatchesB + 100) { // Giá»›i háº¡n vÃ²ng láº·p an toÃ n
        // Sáº¯p xáº¿p cÃ¡c sÃ¢n theo thá»i gian ráº£nh sá»›m nháº¥t
        courtStates.sort((a, b) => a.currentMinutes - b.currentMinutes);
        
        // Láº¥y sÃ¢n ráº£nh sá»›m nháº¥t
        const earliestCourt = courtStates[0];

        // Kiá»ƒm tra sÃ¢n cÃ³ thá»ƒ tiáº¿p tá»¥c xáº¿p lá»‹ch khÃ´ng
        if (earliestCourt.currentMinutes >= timeToMinutes(earliestCourt.startTime) + earliestCourt.maxDurationMinutes) {
             // Náº¿u sÃ¢n Ä‘Ã£ háº¿t thá»i gian lÃ m viá»‡c, chuyá»ƒn sÃ¢n nÃ y xuá»‘ng cuá»‘i Ä‘á»ƒ tÃ¬m sÃ¢n khÃ¡c
             const exhaustedCourt = courtStates.shift();
             courtStates.push(exhaustedCourt);
             
             // Náº¿u táº¥t cáº£ sÃ¢n Ä‘á»u háº¿t thá»i gian, thoÃ¡t
             if (courtStates.every(c => c.currentMinutes >= timeToMinutes(c.startTime) + c.maxDurationMinutes)) {
                 break; 
             }
             continue;
        }
        
        // 6. TÃ¬m tráº­n Ä‘áº¥u phÃ¹ há»£p cho sÃ¢n nÃ y
        let foundMatchIndex = -1;
        
        // Æ¯u tiÃªn xáº¿p loáº¡i tráº­n Ä‘áº¥u mÃ  sÃ¢n nÃ y Ä‘Æ°á»£c Æ°u tiÃªn (mixed/male)
        let preferredGroup = earliestCourt.isMixed ? 'A' : 'B';

        // Lá»±a chá»n 1: TÃ¬m tráº­n cÃ¹ng loáº¡i vá»›i sÃ¢n Æ°u tiÃªn
        foundMatchIndex = allPairs.findIndex(p => p.group === preferredGroup);
        
        // Lá»±a chá»n 2: Náº¿u khÃ´ng tÃ¬m tháº¥y, tÃ¬m tráº­n khÃ¡c loáº¡i (Náº¿u sÃ¢n lÃ  Mixed vÃ  cÃ²n tráº­n Male, hoáº·c ngÆ°á»£c láº¡i)
        if (foundMatchIndex === -1 && allPairs.length > 0) {
            const otherGroup = preferredGroup === 'A' ? 'B' : 'A';
            foundMatchIndex = allPairs.findIndex(p => p.group === otherGroup);
        }

        // 7. Xáº¿p lá»‹ch cho tráº­n Ä‘áº¥u Ä‘Æ°á»£c chá»n
        if (foundMatchIndex !== -1) {
            const match = allPairs.splice(foundMatchIndex, 1)[0];
            
            const matchTime = minutesToTime(earliestCourt.currentMinutes);
            
            const newMatch = {
                id: `M${matchIdCounter++}`,
                time: matchTime,
                court: earliestCourt.name,
                teamA: match.teamA,
                teamB: match.teamB,
                scoreA: null,
                scoreB: null,
                winner: null,
                loser: null
            };
            
            // ThÃªm vÃ o lá»‹ch cá»§a sÃ¢n
            earliestCourt.schedule.push(newMatch);
            
            // Cáº­p nháº­t thá»i gian ráº£nh má»›i cá»§a sÃ¢n
            earliestCourt.currentMinutes += matchDuration; 
            
            // ThÃªm vÃ o state chÃ­nh
            if (match.group === 'A') {
                state.matchesA.push(newMatch);
            } else {
                state.matchesB.push(newMatch);
            }
            scheduledMatchesCount++;
        } else {
            // KhÃ´ng tÃ¬m tháº¥y tráº­n Ä‘áº¥u nÃ o phÃ¹ há»£p vá»›i táº¥t cáº£ cÃ¡c sÃ¢n cÃ²n láº¡i. ThoÃ¡t.
            break;
        }
    }
    
    // 8. Káº¿t quáº£
    if (state.matchesA.length + state.matchesB.length > 0) {
        // Cáº§n pháº£i sáº¯p xáº¿p láº¡i state.matchesA/B theo ID Ä‘á»ƒ index khá»›p vá»›i giao diá»‡n
        state.matchesA.sort((a, b) => a.id.localeCompare(b.id));
        state.matchesB.sort((a, b) => a.id.localeCompare(b.id));

        tinhVaCapNhatXepHang();
        renderMatchesView();
        renderOverview();
        showModal('Táº¡o Lá»‹ch ThÃ nh cÃ´ng', `ÄÃ£ táº¡o ${state.matchesA.length + state.matchesB.length} tráº­n Ä‘áº¥u VÃ²ng Báº£ng tá»‘i Æ°u.`);
        saveToGitHub();
    } else {
        showModal('Lá»—i Táº¡o Lá»‹ch', 'KhÃ´ng thá»ƒ táº¡o lá»‹ch thi Ä‘áº¥u. Kiá»ƒm tra láº¡i cáº¥u hÃ¬nh Ä‘á»™i vÃ  sÃ¢n.');
    }
}

/**
 * LÃªn lá»‹ch VÃ²ng Chung káº¿t (tá»± Ä‘á»™ng Ä‘iá»n sÃ¢n, thá»i gian)
 */
function scheduleFinalsAuto() {
    if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Tá»± Ä‘á»™ng lÃªn lá»‹ch VÃ²ng Chung káº¿t? (BÃ¡n káº¿t: 16:40, Chung káº¿t: 17:30, SÃ¢n 3)")) return;
    
    // Äáº·t láº¡i thá»i gian vÃ  sÃ¢n máº·c Ä‘á»‹nh
    const defaultSF1 = { time: '16:40', court: 'SÃ¢n 3' };
    const defaultSF2 = { time: '17:05', court: 'SÃ¢n 3' };
    const defaultFinal = { time: '17:30', court: 'SÃ¢n 3' };
    
    // BÃ¡n káº¿t 1
    state.semifinals[0].time = defaultSF1.time;
    state.semifinals[0].court = defaultSF1.court;
    
    // BÃ¡n káº¿t 2
    state.semifinals[1].time = defaultSF2.time;
    state.semifinals[1].court = defaultSF2.court;
    
    // Chung káº¿t
    state.final.time = defaultFinal.time;
    state.final.court = defaultFinal.court;
    
    stateChanged = true;
    renderFinals();
    showModal('LÃªn lá»‹ch Chung káº¿t', 'ÄÃ£ tá»± Ä‘á»™ng lÃªn lá»‹ch VÃ²ng Chung káº¿t thÃ nh cÃ´ng (16:40, SÃ¢n 3).');
    saveToGitHub();
}

/**
 * Xá»­ lÃ½ Import Lá»‹ch tá»« file CSV
 */
function handleFileSelect(event) {
    const file = event.target.files[0];
    if (!file) {
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const contents = e.target.result;
        try {
            if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Import lá»‹ch thi Ä‘áº¥u tá»« file CSV? Lá»‹ch thi Ä‘áº¥u hiá»‡n táº¡i sáº½ bá»‹ ghi Ä‘Ã¨.")) return;
            
            const lines = contents.trim().split('\n');
            if (lines.length < 2) {
                showModal('Lá»—i Import', 'File CSV khÃ´ng cÃ³ dá»¯ liá»‡u tráº­n Ä‘áº¥u.');
                return;
            }
            
            // XÃ³a lá»‹ch cÅ©
            state.matchesA = [];
            state.matchesB = [];
            
            const headers = lines[0].split(',').map(h => h.trim());
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values.length !== headers.length) continue; 
                
                const match = {};
                headers.forEach((header, index) => {
                    match[header] = values[index];
                });

                const newMatch = {
                    id: `M${i}`,
                    time: match.time || null,
                    court: match.court || null,
                    teamA: match.teamA,
                    teamB: match.teamB,
                    scoreA: match.scoreA ? parseInt(match.scoreA, 10) : null,
                    scoreB: match.scoreB ? parseInt(match.scoreB, 10) : null,
                    winner: null,
                    loser: null
                };
                
                // XÃ¡c Ä‘á»‹nh Winner/Loser náº¿u cÃ³ Ä‘iá»ƒm
                if (newMatch.scoreA !== null && newMatch.scoreB !== null) {
                     if (newMatch.scoreA > newMatch.scoreB) {
                         newMatch.winner = newMatch.teamA;
                         newMatch.loser = newMatch.teamB;
                     } else if (newMatch.scoreB > newMatch.scoreA) {
                         newMatch.winner = newMatch.teamB;
                         newMatch.loser = newMatch.teamA;
                     }
                }
                
                if (match.bang === 'A') {
                    state.matchesA.push(newMatch);
                } else if (match.bang === 'B') {
                    state.matchesB.push(newMatch);
                }
            }

            stateChanged = true;
            tinhVaCapNhatXepHang();
            renderMatchesView();
            renderOverview();
            showModal('Import Lá»‹ch', `ÄÃ£ import thÃ nh cÃ´ng ${state.matchesA.length + state.matchesB.length} tráº­n Ä‘áº¥u tá»« CSV.`);
            saveToGitHub();

        } catch (error) {
            showModal('Lá»—i Import', `Lá»—i xá»­ lÃ½ file CSV: ${error.message}. Vui lÃ²ng kiá»ƒm tra Ä‘á»‹nh dáº¡ng.`);
            console.error(error);
        }
    };
    reader.readAsText(file, 'UTF-8');
}

/**
 * Xuáº¥t Lá»‹ch ra file CSV
 */
function exportSchedule() {
    const allMatches = [...state.matchesA.map(m => ({ ...m, bang: 'A' })), 
                        ...state.matchesB.map(m => ({ ...m, bang: 'B' }))];
                        
    if (allMatches.length === 0) {
        showModal('Export Lá»‹ch', 'KhÃ´ng cÃ³ lá»‹ch thi Ä‘áº¥u Ä‘á»ƒ xuáº¥t.');
        return;
    }
    
    let csv = "teamA,teamB,time,court,bang,scoreA,scoreB\n";
    allMatches.forEach(match => {
        csv += `"${match.teamA}","${match.teamB}",${match.time || ''},${match.court || ''},${match.bang || ''},${match.scoreA !== null ? match.scoreA : ''},${match.scoreB !== null ? match.scoreB : ''}\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `schedule_tkd_export_${new Date().toISOString().slice(0, 10)}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showModal('Export Lá»‹ch', 'ÄÃ£ xuáº¥t lá»‹ch thi Ä‘áº¥u VÃ²ng Báº£ng ra file CSV.');
}


// --- Khá»Ÿi táº¡o ---

/**
 * HÃ m khá»Ÿi táº¡o chÃ­nh
 */
function init() {
    loadConfig();
    
    // Táº£i dá»¯ liá»‡u tá»« GitHub náº¿u cÃ³ cáº¥u hÃ¬nh
    if (state.config.owner && state.config.repo && state.config.token) {
        // Táº£i tráº¡ng thÃ¡i vÃ  teams (náº¿u cÃ³)
        loadFromGitHub(); 
    } else {
        // Khá»Ÿi táº¡o giao diá»‡n vá»›i dá»¯ liá»‡u máº·c Ä‘á»‹nh (trá»‘ng)
        tinhVaCapNhatXepHang(); 
        renderMatchesView(); 
        renderFinals();
        renderFinalResults();
        renderOverview();
        
        document.getElementById('autoState').className = 'text-danger';
        document.getElementById('autoState').textContent = 'Táº¯t (Thiáº¿u Config)';
        updateStatus('configStatus', 'warning', 'ChÆ°a cáº¥u hÃ¬nh GitHub. Vui lÃ²ng nháº­p thÃ´ng tin káº¿t ná»‘i vÃ  nháº¥n "LÆ°u cáº¥u hÃ¬nh Local".');
    }
}

// Báº¯t Ä‘áº§u á»©ng dá»¥ng khi DOM Ä‘Ã£ táº£i
document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>
