<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pickleball Sync (GitHub API)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background:#f8f9fa; padding:2rem; }
  .card { border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
</style>
</head>
<body>
<div class="container">
  <h2 class="mb-4 text-center">üèì Pickleball Data Sync (GitHub API)</h2>
  <div class="card p-3 mb-4">
    <h5>üîß C·∫•u h√¨nh GitHub</h5>
    <div class="mb-3">
      <label class="form-label">Owner (t√†i kho·∫£n GitHub)</label>
      <input id="owner" type="text" class="form-control" placeholder="VD: tinle">
    </div>
    <div class="mb-3">
      <label class="form-label">Repository</label>
      <input id="repo" type="text" class="form-control" placeholder="VD: Pickleball">
    </div>
    <div class="mb-3">
      <label class="form-label">Token truy c·∫≠p c√° nh√¢n (PAT)</label>
      <input id="token" type="password" class="form-control" placeholder="D√°n token GitHub t·∫°i ƒë√¢y">
    </div>
    <button id="saveConfig" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh</button>
  </div>

  <div class="card p-3">
    <h5>üìÑ Qu·∫£n l√Ω d·ªØ li·ªáu ng∆∞·ªùi ch∆°i</h5>
    <textarea id="jsonData" rows="8" class="form-control mb-2" placeholder="D·ªØ li·ªáu JSON s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y..."></textarea>
    <div class="d-flex gap-2">
      <button id="loadBtn" class="btn btn-success">‚¨áÔ∏è T·∫£i d·ªØ li·ªáu</button>
      <button id="saveBtn" class="btn btn-warning">‚¨ÜÔ∏è Ghi d·ªØ li·ªáu</button>
    </div>
    <div id="status" class="mt-3 text-muted"></div>
  </div>
</div>

<script>
function saveConfig() {
  const cfg = {
    owner: document.getElementById('owner').value.trim(),
    repo: document.getElementById('repo').value.trim(),
    token: document.getElementById('token').value.trim()
  };
  localStorage.setItem('githubConfig', JSON.stringify(cfg));
  document.getElementById('status').innerText = '‚úÖ C·∫•u h√¨nh ƒë√£ l∆∞u!';
}

function loadConfig() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  document.getElementById('owner').value = cfg.owner || '';
  document.getElementById('repo').value = cfg.repo || '';
  document.getElementById('token').value = cfg.token || '';
}

async function loadData() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  if (!cfg.token || !cfg.owner || !cfg.repo) return alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c·∫•u h√¨nh!');
  const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/data/players.json`;
  const res = await fetch(url, {
    headers: { "Authorization": `token ${cfg.token}`, "Accept": "application/vnd.github.v3+json" }
  });
  if (!res.ok) {
    document.getElementById('status').innerText = '‚ùå L·ªói t·∫£i d·ªØ li·ªáu: ' + res.status;
    return;
  }
  const data = await res.json();
  const decoded = atob(data.content);
  document.getElementById('jsonData').value = decoded;
  document.getElementById('status').innerText = '‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng!';
}

async function saveData() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  if (!cfg.token || !cfg.owner || !cfg.repo) return alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c·∫•u h√¨nh!');
  const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/data/players.json`;
  const res = await fetch(url, {
    headers: { "Authorization": `token ${cfg.token}`, "Accept": "application/vnd.github.v3+json" }
  });
  const json = await res.json();
  const sha = json.sha;
  const newContent = btoa(document.getElementById('jsonData').value);
  const update = await fetch(url, {
    method: "PUT",
    headers: {
      "Authorization": `token ${cfg.token}`,
      "Accept": "application/vnd.github.v3+json",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "Update data via Pickleball App",
      content: newContent,
      sha: sha
    })
  });
  const result = await update.json();
  document.getElementById('status').innerText = result.commit ? '‚úÖ Ghi d·ªØ li·ªáu th√†nh c√¥ng!' : '‚ùå Ghi th·∫•t b·∫°i!';
}

document.getElementById('saveConfig').onclick = saveConfig;
document.getElementById('loadBtn').onclick = loadData;
document.getElementById('saveBtn').onclick = saveData;

loadConfig();
</script>
</body>
</html>
