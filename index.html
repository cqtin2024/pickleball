<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TKD Championship 2025 — Quản lý giải Pickleball V10</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f9fc; font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#222; padding:18px; }
    .tab-content { margin-top: 18px; }
    .logo { width:64px; height:64px; object-fit:contain; border-radius:8px; border:1px solid #e6eefc; padding:6px; background:#fff; }
    table th { background:#0d6efd; color:#fff; position:sticky; top:0; }
    .status { font-size:0.95rem; color:#555; }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
      <img class="logo" src="data/logoTKD.png" alt="Logo">
      <div>
        <h3 class="mb-0">TKD Championship 2025</h3>
        <div>Ngày thi đấu: 18/10/2025</div>
      </div>
    </div>
    <div>
      <div id="autoSaveStatus" class="text-end status">Auto-save: <span id="autoState">Tắt</span></div>
      <div id="lastSaved" class="text-end status">Chưa lưu</div>
    </div>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#overview">Tổng quan</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#players">Người chơi</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#matches">Trận đấu</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#results">Kết quả</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#config">Cấu hình</button></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active p-3" id="overview"><div id="overviewContent"></div></div>
    <div class="tab-pane fade p-3" id="players"><div id="playersTable"></div></div>

    <div class="tab-pane fade p-3" id="matches">
      <button class="btn btn-sm btn-primary mb-2" onclick="taoLichThiDau()">Tạo lịch thi đấu tự động</button>
      <h6>Bảng A</h6><div id="tableMatchesA"></div>
      <h6 class="mt-3">Bảng B</h6><div id="tableMatchesB"></div>
      <button class="btn btn-success mt-3" onclick="tinhXepHang()">Cập nhật bảng xếp hạng</button>
      <div id="rankingTables" class="mt-3"></div>
    </div>

    <div class="tab-pane fade p-3" id="results"><div id="resultsContent"></div></div>

    <div class="tab-pane fade p-3" id="config">
      <div class="row g-2 mb-2">
        <div class="col-md-3"><input id="cfgOwner" class="form-control" placeholder="Owner"></div>
        <div class="col-md-3"><input id="cfgRepo" class="form-control" placeholder="Repo"></div>
        <div class="col-md-3"><input id="cfgFolder" class="form-control" value="data"></div>
        <div class="col-md-3"><input id="cfgFile" class="form-control" value="players.json"></div>
      </div>
      <input id="cfgToken" type="password" class="form-control mb-2" placeholder="Dán token tại đây">
      <button class="btn btn-primary" onclick="saveConfig()">Lưu cấu hình</button>
    </div>
  </div>
</div>

<script>
let state = { mixedTeams: ["Hậu-Dũng","Hạnh-Tiến","Giang-Long","Huyền-Luân","Linh-M.Hùng","Hường-Đạt"], maleTeams: ["Thủy-Tiệp","Thanh-Phương","Minh-Triều","Tín-Khiêm","Ánh-Toàn","Hiển-P.Hùng"], matchesA: [], matchesB: [] };
function taoLichThiDau(){const thoiGianBatDau=new Date('2025-10-18T14:00:00');const thoiLuong=15*60000;state.matchesA=taoRoundRobin(state.mixedTeams,['Sân 2','Sân 3'],['Sân 7'],thoiGianBatDau,thoiLuong);state.matchesB=taoRoundRobin(state.maleTeams,['Sân 7','Sân 8'],['Sân 8'],thoiGianBatDau,thoiLuong);renderMatches();}
function taoRoundRobin(teams,sanDau1,sanDau2,start,duration){const lich=[];let time=new Date(start);for(let i=0;i<teams.length;i++){for(let j=i+1;j<teams.length;j++){const phase=time.getHours()<15?1:2;const san=phase===1?sanDau1[(lich.length)%sanDau1.length]:sanDau2[(lich.length)%sanDau2.length];lich.push({teamA:teams[i],teamB:teams[j],time:time.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'}),court:san});time=new Date(time.getTime()+duration);}}return lich;}
function renderMatches(){document.getElementById('tableMatchesA').innerHTML=renderMatchesTable(state.matchesA,'A');document.getElementById('tableMatchesB').innerHTML=renderMatchesTable(state.matchesB,'B');}
function renderMatchesTable(list,id){if(!list.length)return'<div>Chưa có trận đấu</div>';let html="<table class='table table-bordered table-sm'><thead><tr><th>Đội A</th><th>Đội B</th><th>Tỉ số</th><th>Giờ</th><th>Sân</th></tr></thead><tbody>";list.forEach((m,i)=>{html+=`<tr><td>${m.teamA}</td><td>${m.teamB}</td><td><input type='number' value='${m.scoreA||''}' style='width:50px' onchange='capNhatTiSo("${id}",${i},this.value,true)'> - <input type='number' value='${m.scoreB||''}' style='width:50px' onchange='capNhatTiSo("${id}",${i},this.value,false)'></td><td>${m.time}</td><td>${m.court}</td></tr>`});return html+="</tbody></table>";}
function capNhatTiSo(bang,index,val,isA){const list=bang==='A'?state.matchesA:state.matchesB;if(!list[index])return;if(isA)list[index].scoreA=parseInt(val||0);else list[index].scoreB=parseInt(val||0);}
function tinhXepHang(){const A=tinhDiemBang(state.matchesA);const B=tinhDiemBang(state.matchesB);state.tableA=A;state.tableB=B;renderBangXepHang('A',A);renderBangXepHang('B',B);}
function tinhDiemBang(matches){const table={};matches.forEach(m=>{if(!m.teamA||!m.teamB)return;if(!table[m.teamA])table[m.teamA]={team:m.teamA,wins:0,losses:0,pointsW:0,pointsL:0};if(!table[m.teamB])table[m.teamB]={team:m.teamB,wins:0,losses:0,pointsW:0,pointsL:0};if(m.scoreA==null||m.scoreB==null)return;const aWin=m.scoreA>m.scoreB,bWin=m.scoreB>m.scoreA;if(aWin)table[m.teamA].wins++,table[m.teamB].losses++;else if(bWin)table[m.teamB].wins++,table[m.teamA].losses++;table[m.teamA].pointsW+=m.scoreA;table[m.teamA].pointsL+=m.scoreB;table[m.teamB].pointsW+=m.scoreB;table[m.teamB].pointsL+=m.scoreA;});let list=Object.values(table);list.forEach(t=>{t.diff=t.pointsW-t.pointsL;t.points=t.wins*2});list.sort((a,b)=>b.points-a.points||b.diff-a.diff||b.pointsW-a.pointsW||Math.random()-0.5);return list;}
function renderBangXepHang(bang,list){let html=`<h6>Bảng ${bang}</h6><table class='table table-striped'><thead><tr><th>Đội</th><th>Thắng</th><th>Thua</th><th>Điểm</th><th>Hiệu số</th></tr></thead><tbody>`;list.forEach(r=>{html+=`<tr><td>${r.team}</td><td>${r.wins}</td><td>${r.losses}</td><td>${r.points}</td><td>${r.diff}</td></tr>`});html+='</tbody></table>';document.getElementById('rankingTables').innerHTML+=html;}
function saveConfig(){const cfg={owner:cfgOwner.value,repo:cfgRepo.value,folder:cfgFolder.value,file:cfgFile.value,token:cfgToken.value};localStorage.setItem('pkb_config',JSON.stringify(cfg));alert('Đã lưu cấu hình');}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
