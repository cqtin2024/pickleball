<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Quáº£n lÃ½ dá»¯ liá»‡u Pickleball</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f9fafb; color: #222; padding: 20px; font-family: "Segoe UI", "Roboto", sans-serif; }
    .card { border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    table { font-size: 15px; border-collapse: collapse; width: 100%; }
    th, td { text-align: left; padding: 8px 12px; }
    th { background-color: #0d6efd; color: #fff; position: sticky; top: 0; }
    tr:nth-child(even) { background-color: #f2f6ff; }
    input, textarea { font-family: "Consolas", monospace; }
    .footer { font-size: 13px; color: #666; margin-top: 20px; text-align: center; }
  </style>
</head>
<body>
<div class="container">
  <h3 class="mb-4 text-center fw-bold text-primary">ğŸ“ Quáº£n lÃ½ & Ä‘á»“ng bá»™ dá»¯ liá»‡u Pickleball</h3>

  <!-- Cáº¥u hÃ¬nh -->
  <div class="card p-3 mb-3">
    <h5 class="mb-3 text-secondary">âš™ï¸ Cáº¥u hÃ¬nh GitHub</h5>
    <div class="row g-2">
      <div class="col-md-3"><input id="owner" class="form-control" placeholder="Chá»§ sá»Ÿ há»¯u (VD: your-username)"></div>
      <div class="col-md-3"><input id="repo" class="form-control" placeholder="TÃªn repo (VD: Pickleball)"></div>
      <div class="col-md-3"><input id="folder" class="form-control" placeholder="ThÆ° má»¥c (VD: data)" value="data"></div>
      <div class="col-md-3"><input id="file" class="form-control" placeholder="TÃªn file (VD: players.json)" value="players.json"></div>
    </div>
    <div class="mt-2 d-flex">
      <input id="token" type="password" class="form-control me-2" placeholder="DÃ¡n GitHub Token táº¡i Ä‘Ã¢y (chá»‰ lÆ°u cá»¥c bá»™)">
      <button class="btn btn-outline-secondary" onclick="clearToken()">ğŸ§¹ XÃ³a token</button>
    </div>
    <div class="mt-3 text-end">
      <button class="btn btn-outline-primary me-2" onclick="loadData()">ğŸ“‚ Äá»c dá»¯ liá»‡u</button>
      <button class="btn btn-outline-success" onclick="saveData()">ğŸ’¾ Ghi dá»¯ liá»‡u</button>
    </div>
  </div>

  <!-- Hiá»ƒn thá»‹ dá»¯ liá»‡u -->
  <div class="card p-3">
    <h5 class="text-secondary mb-2">ğŸ“‹ Dá»¯ liá»‡u hiá»ƒn thá»‹</h5>
    <div id="dataArea" class="table-responsive border rounded p-2 bg-white">
      <p class="text-muted">ChÆ°a cÃ³ dá»¯ liá»‡u. Nháº¥n â€œÄá»c dá»¯ liá»‡uâ€ Ä‘á»ƒ táº£i tá»« GitHub.</p>
    </div>
  </div>

  <div class="footer">PhiÃªn báº£n demo hiá»ƒn thá»‹ chuáº©n tiáº¿ng Viá»‡t Â· Dá»¯ liá»‡u Ä‘á»“ng bá»™ qua GitHub API Â· Token lÆ°u táº¡m cá»¥c bá»™</div>
</div>

<script>
window.addEventListener('load', () => {
  const savedToken = localStorage.getItem('github_token');
  if (savedToken) document.getElementById('token').value = savedToken;
});

document.getElementById('token').addEventListener('change', (e) => {
  localStorage.setItem('github_token', e.target.value);
});

function clearToken() {
  localStorage.removeItem('github_token');
  document.getElementById('token').value = '';
  alert('âœ… Token Ä‘Ã£ Ä‘Æ°á»£c xÃ³a khá»i bá»™ nhá»› cá»¥c bá»™.');
}

async function loadData() {
  const owner = document.getElementById('owner').value.trim();
  const repo = document.getElementById('repo').value.trim();
  const folder = document.getElementById('folder').value.trim();
  const file = document.getElementById('file').value.trim();
  const token = document.getElementById('token').value.trim();
  const dataArea = document.getElementById('dataArea');

  if (!owner || !repo || !file || !token) {
    alert('âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin: Chá»§ sá»Ÿ há»¯u, Repo, File, Token!');
    return;
  }

  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}/${file}`;

  try {
    const res = await fetch(url, { headers: { Authorization: `token ${token}` } });
    if (!res.ok) throw new Error("KhÃ´ng thá»ƒ Ä‘á»c file tá»« GitHub (kiá»ƒm tra quyá»n truy cáº­p hoáº·c tÃªn file)");
    const json = await res.json();
    const content = decodeURIComponent(escape(atob(json.content)));

    let data;
    if (file.endsWith('.csv')) {
      data = parseCSV(content);
      renderTable(data);
    } else {
      data = JSON.parse(content);
      renderTableFromJSON(data);
    }
  } catch (err) {
    dataArea.innerHTML = `<div class='text-danger'>âŒ Lá»—i khi Ä‘á»c dá»¯ liá»‡u: ${err.message}</div>`;
  }
}

function parseCSV(content) {
  const lines = content.trim().split(/\r?\n/);
  const headers = lines[0].split(',').map(h => h.trim());
  return lines.slice(1).map(line => {
    const values = line.split(',');
    const obj = {};
    headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : '');
    return obj;
  });
}

function renderTable(data) {
  if (!data.length) return document.getElementById('dataArea').innerHTML = "KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ hiá»ƒn thá»‹.";
  const headers = Object.keys(data[0]);
  let html = "<table class='table table-bordered table-hover align-middle'>";
  html += "<thead><tr>" + headers.map(h => `<th>${chuanTieuDe(h)}</th>`).join('') + "</tr></thead><tbody>";
  html += data.map(row => "<tr>" + headers.map(h => `<td>${row[h] || ''}</td>`).join('') + "</tr>").join('');
  html += "</tbody></table>";
  document.getElementById('dataArea').innerHTML = html;
}

function renderTableFromJSON(data) {
  if (Array.isArray(data)) renderTable(data);
  else if (typeof data === 'object') {
    const rows = Object.entries(data).map(([k, v]) => ({ "TrÆ°á»ng": chuanTieuDe(k), "GiÃ¡ trá»‹": JSON.stringify(v, null, 2) }));
    renderTable(rows);
  } else {
    document.getElementById('dataArea').innerHTML = `<pre>${data}</pre>`;
  }
}

async function saveData() {
  const owner = document.getElementById('owner').value.trim();
  const repo = document.getElementById('repo').value.trim();
  const folder = document.getElementById('folder').value.trim();
  const file = document.getElementById('file').value.trim();
  const token = document.getElementById('token').value.trim();

  if (!owner || !repo || !file || !token) {
    alert('âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
    return;
  }

  const newContent = prompt("Nháº­p ná»™i dung JSON má»›i Ä‘á»ƒ lÆ°u:", "{}");
  if (!newContent) return;

  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}/${file}`;
  const getRes = await fetch(url, { headers: { Authorization: `token ${token}` } });
  const getData = await getRes.json();
  const sha = getData.sha;

  const body = {
    message: "Cáº­p nháº­t dá»¯ liá»‡u tá»« á»©ng dá»¥ng Pickleball",
    content: btoa(unescape(encodeURIComponent(newContent))),
    sha: sha
  };

  const res = await fetch(url, {
    method: "PUT",
    headers: {
      Authorization: `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  if (res.ok) alert("âœ… Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c ghi thÃ nh cÃ´ng lÃªn GitHub!");
  else alert("âŒ Ghi dá»¯ liá»‡u tháº¥t báº¡i! Kiá»ƒm tra Token hoáº·c quyá»n repo.");
}

// Chuáº©n hoÃ¡ tiÃªu Ä‘á» tiáº¿ng Viá»‡t
function chuanTieuDe(key) {
  const map = {
    name: "Há» vÃ  tÃªn", fullname: "Há» vÃ  tÃªn",
    id: "MÃ£ sá»‘", team: "Äá»™i", age: "Tuá»•i",
    gender: "Giá»›i tÃ­nh", rank: "Háº¡ng", phone: "Sá»‘ Ä‘iá»‡n thoáº¡i",
    email: "Email", score: "Äiá»ƒm", result: "Káº¿t quáº£",
    match: "Tráº­n Ä‘áº¥u", note: "Ghi chÃº"
  };
  return map[key.toLowerCase()] || key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
}
</script>
</body>
</html>
