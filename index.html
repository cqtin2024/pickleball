<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pickleball Data Sync (GitHub API)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background:#f8f9fa; padding:2rem; }
  .card { border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
  textarea { font-family: monospace; white-space: pre; }
</style>
</head>
<body>
<div class="container">
  <h2 class="mb-4 text-center">ğŸ“ Pickleball Data Sync (GitHub API)</h2>

  <!-- Cáº¥u hÃ¬nh GitHub -->
  <div class="card p-3 mb-4">
    <h5>ğŸ”§ Cáº¥u hÃ¬nh GitHub</h5>
    <div class="mb-3">
      <label class="form-label">ğŸ‘¤ Chá»§ sá»Ÿ há»¯u (owner)</label>
      <input id="owner" type="text" class="form-control" placeholder="VD: tinle">
    </div>
    <div class="mb-3">
      <label class="form-label">ğŸ“ TÃªn kho (repository)</label>
      <input id="repo" type="text" class="form-control" placeholder="VD: Pickleball">
    </div>
    <div class="mb-3">
      <label class="form-label">ğŸ“„ ÄÆ°á»ng dáº«n file trong repo</label>
      <input id="filePath" type="text" class="form-control" value="data/players.json">
      <small class="text-muted">Máº·c Ä‘á»‹nh: <code>data/players.json</code></small>
    </div>
    <div class="mb-3">
      <label class="form-label">ğŸ”‘ Token truy cáº­p cÃ¡ nhÃ¢n (PAT)</label>
      <input id="token" type="password" class="form-control" placeholder="DÃ¡n token GitHub táº¡i Ä‘Ã¢y">
    </div>
    <button id="saveConfig" class="btn btn-primary">ğŸ’¾ LÆ°u cáº¥u hÃ¬nh</button>
  </div>

  <!-- Quáº£n lÃ½ dá»¯ liá»‡u -->
  <div class="card p-3">
    <h5>ğŸ“„ Quáº£n lÃ½ dá»¯ liá»‡u JSON</h5>
    <textarea id="jsonData" rows="12" class="form-control mb-3" placeholder="Dá»¯ liá»‡u JSON sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y..."></textarea>
    <div class="d-flex gap-2 flex-wrap">
      <button id="loadBtn" class="btn btn-success">â¬‡ï¸ Táº£i dá»¯ liá»‡u</button>
      <button id="saveBtn" class="btn btn-warning">â¬†ï¸ Ghi dá»¯ liá»‡u</button>
      <button id="formatBtn" class="btn btn-secondary">ğŸ§¹ Äá»‹nh dáº¡ng JSON</button>
      <button id="clearCfgBtn" class="btn btn-outline-danger">ğŸ—‘ XoÃ¡ cáº¥u hÃ¬nh</button>
    </div>
    <div id="status" class="mt-3 text-muted"></div>
  </div>
</div>

<script>
function showStatus(msg, type = 'info') {
  const el = document.getElementById('status');
  el.innerText = msg;
  el.style.color = type === 'error' ? 'red' : (type === 'success' ? 'green' : 'gray');
}

function saveConfig() {
  const cfg = {
    owner: document.getElementById('owner').value.trim(),
    repo: document.getElementById('repo').value.trim(),
    token: document.getElementById('token').value.trim(),
    filePath: document.getElementById('filePath').value.trim() || 'data/players.json'
  };
  localStorage.setItem('githubConfig', JSON.stringify(cfg));
  showStatus('âœ… Cáº¥u hÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c lÆ°u!', 'success');
}

function loadConfig() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  document.getElementById('owner').value = cfg.owner || '';
  document.getElementById('repo').value = cfg.repo || '';
  document.getElementById('token').value = cfg.token || '';
  document.getElementById('filePath').value = cfg.filePath || 'data/players.json';
}

function clearConfig() {
  localStorage.removeItem('githubConfig');
  showStatus('ğŸ—‘ Cáº¥u hÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c xoÃ¡.', 'info');
}

async function loadData() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  if (!cfg.token || !cfg.owner || !cfg.repo)
    return alert('âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ cáº¥u hÃ¬nh!');

  showStatus('â³ Äang táº£i dá»¯ liá»‡u...');
  const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${cfg.filePath}`;
  
  try {
    const res = await fetch(url, {
      headers: { "Authorization": `token ${cfg.token}`, "Accept": "application/vnd.github.v3+json" }
    });
    if (!res.ok) throw new Error(`KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u (${res.status})`);
    const data = await res.json();
    const decoded = new TextDecoder("utf-8").decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));
    const pretty = JSON.stringify(JSON.parse(decoded), null, 2);
    document.getElementById('jsonData').value = pretty;
    showStatus(`âœ… ÄÃ£ táº£i dá»¯ liá»‡u tá»« ${cfg.filePath}`, 'success');
  } catch (err) {
    showStatus('âŒ ' + err.message, 'error');
  }
}

async function saveData() {
  const cfg = JSON.parse(localStorage.getItem('githubConfig') || '{}');
  if (!cfg.token || !cfg.owner || !cfg.repo)
    return alert('âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ cáº¥u hÃ¬nh!');

  showStatus('ğŸ’¾ Äang ghi dá»¯ liá»‡u lÃªn GitHub...');
  const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${cfg.filePath}`;
  
  try {
    const getRes = await fetch(url, {
      headers: { "Authorization": `token ${cfg.token}`, "Accept": "application/vnd.github.v3+json" }
    });
    const json = await getRes.json();
    const sha = json.sha;
    const newContent = btoa(unescape(encodeURIComponent(document.getElementById('jsonData').value)));

    const update = await fetch(url, {
      method: "PUT",
      headers: {
        "Authorization": `token ${cfg.token}`,
        "Accept": "application/vnd.github.v3+json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Cáº­p nháº­t dá»¯ liá»‡u (${cfg.filePath}) qua Pickleball WebApp`,
        content: newContent,
        sha: sha
      })
    });
    const result = await update.json();
    if (result.commit)
      showStatus(`âœ… Ghi dá»¯ liá»‡u thÃ nh cÃ´ng vÃ o ${cfg.filePath}`, 'success');
    else
      showStatus('âŒ Ghi tháº¥t báº¡i: ' + (result.message || 'KhÃ´ng rÃµ lá»—i'), 'error');
  } catch (err) {
    showStatus('âŒ ' + err.message, 'error');
  }
}

function formatJSON() {
  try {
    const formatted = JSON.stringify(JSON.parse(document.getElementById('jsonData').value), null, 2);
    document.getElementById('jsonData').value = formatted;
    showStatus('âœ¨ JSON Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh dáº¡ng!', 'success');
  } catch (e) {
    showStatus('âš ï¸ JSON khÃ´ng há»£p lá»‡, khÃ´ng thá»ƒ Ä‘á»‹nh dáº¡ng.', 'error');
  }
}

document.getElementById('saveConfig').onclick = saveConfig;
document.getElementById('loadBtn').onclick = loadData;
document.getElementById('saveBtn').onclick = saveData;
document.getElementById('formatBtn').onclick = formatJSON;
document.getElementById('clearCfgBtn').onclick = clearConfig;
loadConfig();
</script>
</body>
</html>
