<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pickleball Tournament - Data Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; max-width: 720px; }
    h1 { color: #2c3e50; }
    input, button, textarea { padding: 8px; margin: 5px 0; font-size: 16px; width: 100%; box-sizing: border-box; }
    section { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
    .hidden { display: none; }
    pre { background: #f6f6f6; padding: 10px; border-radius: 6px; font-size: 14px; overflow:auto; }
    .ok { color: #27ae60; }
    .err { color: #c0392b; }
    small { color: #666; }
  </style>
</head>
<body>
  <h1>ğŸ“ Pickleball Tournament â€“ Data Manager</h1>
  <p>HÆ°á»›ng dáº«n nhanh: táº¡o <b>Fine-grained Personal Access Token</b> trÃªn GitHub (Permissions: repo contents read & write) vÃ  dÃ¡n vÃ o Ã´ bÃªn dÆ°á»›i. <small>(Token Ä‘Æ°á»£c lÆ°u cá»¥c bá»™ trÃªn trÃ¬nh duyá»‡t)</small></p>

  <section id="setupSection">
    <h2>ğŸ§© BÆ°á»›c 1. Táº¡o GitHub Token</h2>
    <ol>
      <li>Má»Ÿ: <a href="https://github.com/settings/tokens?type=fine-grained" target="_blank">https://github.com/settings/tokens?type=fine-grained</a></li>
      <li>Nháº¥n <b>Generate new token</b></li>
      <li>Repository access: chá»n repo cá»§a báº¡n (vÃ­ dá»¥ <code>Pickleball</code>)</li>
      <li>Permissions: <b>Contents â†’ Read and write</b></li>
      <li>Sao chÃ©p token (chá»‰ hiá»‡n 1 láº§n)</li>
    </ol>

    <h2>ğŸ”‘ BÆ°á»›c 2. DÃ¡n Token vÃ o Ä‘Ã¢y:</h2>
    <input type="password" id="tokenInput" placeholder="DÃ¡n GitHub token táº¡i Ä‘Ã¢y..." />
    <button id="saveTokenBtn">LÆ°u token & tiáº¿p tá»¥c</button>
    <p id="tokenStatus"></p>
  </section>

  <section id="mainApp" class="hidden">
    <h2>ğŸ… Quáº£n lÃ½ ngÆ°á»i chÆ¡i</h2>
    <label>TÃªn ngÆ°á»i chÆ¡i:</label>
    <input id="playerName" type="text" placeholder="Nháº­p tÃªn ngÆ°á»i chÆ¡i..." />
    <button id="saveBtn">LÆ°u vÃ o GitHub</button>
    <pre id="log"></pre>

    <h3>âš™ï¸ Cáº¥u hÃ¬nh hiá»‡n táº¡i</h3>
    <pre id="configDisplay"></pre>
    <button id="clearTokenBtn" style="background:#eee;">XoÃ¡ token vÃ  cáº¥u hÃ¬nh</button>

    <section>
      <h3>ğŸ” HÆ°á»›ng dáº«n Ä‘á»“ng bá»™</h3>
      <ol>
        <li>Sau khi thÃªm ngÆ°á»i chÆ¡i, Action sáº½ commit thay Ä‘á»•i vÃ o <code>/data/players.json</code>.</li>
        <li>Má»Ÿ repository trÃªn GitHub Ä‘á»ƒ kiá»ƒm tra file <code>data/players.json</code> vÃ  cÃ¡c commit.</li>
        <li>Náº¿u muá»‘n thay Ä‘á»•i tÃªn repo trÃªn giao diá»‡n, chá»‰nh biáº¿n <code>owner</code> hoáº·c <code>repo</code> bÃªn dÆ°á»›i trong file <code>index.html</code>.</li>
      </ol>
    </section>
  </section>

  <script>
    // ====== CONFIG ======
    // Thay YOUR_GITHUB_USERNAME báº±ng tÃªn user GitHub cá»§a báº¡n.
    const owner = "YOUR_GITHUB_USERNAME";
    const repo  = "Pickle";
    const eventType = "update_data";
    const tokenKey = "github_token_pickleb";

    // ====== UI refs ======
    const tokenInput = document.getElementById("tokenInput");
    const saveTokenBtn = document.getElementById("saveTokenBtn");
    const tokenStatus = document.getElementById("tokenStatus");
    const setupSection = document.getElementById("setupSection");
    const mainApp = document.getElementById("mainApp");
    const logEl = document.getElementById("log");
    const configDisplay = document.getElementById("configDisplay");

    // If token exists in localStorage, skip setup
    const savedToken = localStorage.getItem(tokenKey);
    if (savedToken) showMainApp(savedToken);

    saveTokenBtn.onclick = () => {
      const token = tokenInput.value.trim();
      if (!token) return alert("Vui lÃ²ng dÃ¡n token GitHub!");
      localStorage.setItem(tokenKey, token);
      showMainApp(token);
    };

    function showMainApp(token) {
      setupSection.classList.add("hidden");
      mainApp.classList.remove("hidden");
      configDisplay.textContent = JSON.stringify({ owner, repo, token: token.slice(0, 6) + "..." }, null, 2);
    }

    document.getElementById("clearTokenBtn").onclick = () => {
      localStorage.removeItem(tokenKey);
      location.reload();
    };

    // Save player
    document.getElementById("saveBtn").onclick = async () => {
      const token = localStorage.getItem(tokenKey);
      const name = document.getElementById("playerName").value.trim();
      if (!token) return alert("Báº¡n chÆ°a dÃ¡n token!");
      if (!name) return alert("Nháº­p tÃªn ngÆ°á»i chÆ¡i!");

      // Prepare payload for repository_dispatch
      const payload = {
        event_type: eventType,
        client_payload: {
          file: "players.json",
          newData: { name: name, time: new Date().toISOString() }
        }
      };

      logEl.textContent = "â³ Äang gá»­i yÃªu cáº§u tá»›i GitHub Actions...";
      logEl.className = "";
      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/dispatches`, {
          method: "POST",
          headers: {
            "Accept": "application/vnd.github+json",
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (res.ok || res.status === 204) {
          logEl.textContent = "âœ… Gá»­i thÃ nh cÃ´ng! Dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c cáº­p nháº­t trong vÃ i giÃ¢y (kiá»ƒm tra commit trong repo).";
          logEl.className = "ok";
        } else {
          const txt = await res.text();
          logEl.textContent = "âŒ Lá»—i: " + txt;
          logEl.className = "err";
        }
      } catch (e) {
        logEl.textContent = "âŒ Lá»—i máº¡ng hoáº·c fetch: " + e.message;
        logEl.className = "err";
      }
    };
  </script>
</body>
</html>
