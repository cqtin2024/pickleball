<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TKD PICKLEBALL CHAMPIONSHIP 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f0f4f8; overflow-x: hidden; scroll-behavior: smooth; }
    #content-carousel { display: flex; width: 300vw; transition: transform 0.35s cubic-bezier(0.25, 1, 0.5, 1); }
    .swipe-section { 
      width: 100vw; 
      flex-shrink: 0; 
      padding: 1rem; 
      min-height: calc(100vh - 160px); 
      overflow-y: auto; 
      scroll-behavior: smooth; 
      -webkit-overflow-scrolling: touch; 
    }
    #refresh-btn { position: fixed; bottom: 20px; right: 20px; z-index: 50; background-color: #0284c7; color: white; font-weight: bold; padding: 14px; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.2s; }
    #refresh-btn:hover { transform: scale(1.1); background-color: #0369a1; }
    .winner-glow { animation: glow 1s ease-in-out 2 alternate; }
    @keyframes glow { from { box-shadow: 0 0 10px #00e676; } to { box-shadow: 0 0 25px #00e676; } }
    .top1 { background-color: #d1fae5; font-weight: 700; animation: pulse1 1s ease-in-out infinite alternate; }
    .top2 { background-color: #e0f2fe; font-weight: 600; animation: pulse2 1s ease-in-out infinite alternate; }
    @keyframes pulse1 { from { box-shadow: 0 0 10px #22c55e; } to { box-shadow: 0 0 25px #22c55e; } }
    @keyframes pulse2 { from { box-shadow: 0 0 10px #0ea5e9; } to { box-shadow: 0 0 25px #0ea5e9; } }
    .tab-btn.active-knockout { background: linear-gradient(to right, #22c55e, #16a34a); color: #fff !important; box-shadow: 0 0 10px rgba(34,197,94,0.7); }
    .tab-btn.active-pick { background: linear-gradient(to right, #f59e0b, #d97706); color: white !important; box-shadow: 0 0 10px rgba(245,158,11,0.6); }
    header img { transform: scale(1.5); transition: transform 0.3s; } /* logo g·∫•p 1.5 l·∫ßn */
  </style>
</head>
<body class="font-sans">
  <header class="fixed top-0 left-0 right-0 z-30 bg-white shadow-md p-4">
    <div class="flex items-center justify-center mb-2">
      <img src="https://raw.githubusercontent.com/cqtin2024/pickleball/main/data/logoTKD.png" alt="Logo TKD" class="h-20 w-auto mr-2" />
      <h1 class="text-xl font-extrabold text-blue-800 text-center">TKD PICKLEBALL CHAMPIONSHIP 2025</h1>
    </div>
    <p class="text-center text-gray-600 text-sm">Ng√†y 18/10/2025</p>
    <div id="tab-controls" class="flex justify-around mt-3 mb-2 max-w-2xl mx-auto">
      <button onclick="goToSection(0)" class="tab-btn active px-4 py-2 text-sm font-semibold rounded-full bg-blue-600 text-white">V√≤ng B·∫£ng</button>
      <button onclick="goToSection(1)" class="tab-btn px-4 py-2 text-sm font-semibold rounded-full bg-green-100 text-green-800">Knock-out</button>
      <button onclick="goToSection(2)" class="tab-btn px-4 py-2 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">Pick th·ªß</button>
    </div>
    <div id="statusMessage" class="text-center text-sm font-medium text-gray-600">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  </header>

  <main id="main-content-wrapper" class="pt-[180px] md:pt-[150px] overflow-hidden">
    <div id="content-carousel">
      <section class="swipe-section" id="rounds"></section>
      <section class="swipe-section" id="knockout"></section>
      <section class="swipe-section" id="players"></section>
    </div>
  </main>

  <button id="refresh-btn" title="T·∫£i l·∫°i d·ªØ li·ªáu" onclick="manualRefresh()">‚ü≥</button>

  <script>
    const BASE_URL = window.location.hostname.includes('github.io')
      ? './data/state.json'
      : 'https://raw.githubusercontent.com/cqtin2024/pickleball/main/data/state.json';
    const REFRESH_INTERVAL = 30000;
    const carousel = document.getElementById('content-carousel');
    let currentIndex = 0;
    let startX = 0, deltaX = 0, isSwiping = false;

    // ==== TAB & CAROUSEL ====
    function goToSection(index) {
      const prevIndex = currentIndex;
      currentIndex = Math.max(0, Math.min(2, index));
      carousel.style.transition = 'transform 0.35s cubic-bezier(0.25,1,0.5,1)';
      carousel.style.transform = `translateX(${currentIndex * -100}vw)`;
      updateTabs();
      if (prevIndex !== currentIndex) {
        // Scroll l√™n ƒë·∫ßu ch·ªâ khi chuy·ªÉn tab
        document.querySelectorAll('.swipe-section')[currentIndex].scrollTop = 0;
      }
    }

    function updateTabs() {
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        btn.classList.remove('active-knockout', 'active-pick', 'bg-blue-600', 'text-white');
        if (i === currentIndex) {
          if (i === 0) btn.classList.add('bg-blue-600', 'text-white');
          if (i === 1) btn.classList.add('active-knockout');
          if (i === 2) btn.classList.add('active-pick');
        }
      });
    }

    // ==== SWIPE HANDLERS ====
    carousel.addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
      deltaX = 0;
      isSwiping = true;
      carousel.style.transition = 'none';
    });

    carousel.addEventListener('touchmove', e => {
      if (!isSwiping) return;
      const x = e.touches[0].clientX;
      deltaX = x - startX;
      carousel.style.transform = `translateX(${currentIndex * -100 + deltaX / window.innerWidth * 100}vw)`;
    });

    carousel.addEventListener('touchend', e => {
      isSwiping = false;
      carousel.style.transition = 'transform 0.35s cubic-bezier(0.25,1,0.5,1)';
      if (deltaX > 50) goToSection(currentIndex - 1);
      else if (deltaX < -50) goToSection(currentIndex + 1);
      else goToSection(currentIndex);
    });

    // ==== FETCH & REFRESH ====
    async function fetchData() {
      const msg = document.getElementById('statusMessage');
      msg.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';
      try {
        const res = await fetch(BASE_URL, { cache: 'no-store' });
        const data = await res.json();
        msg.textContent = 'ƒê√£ t·∫£i d·ªØ li·ªáu (' + new Date().toLocaleTimeString('vi-VN') + ')';
        renderData(data);
      } catch (err) {
        msg.textContent = '‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu: ' + err.message;
      }
    }

    function manualRefresh() {
      const btn = document.getElementById('refresh-btn');
      btn.classList.add('animate-spin');
      fetchData().finally(() => setTimeout(() => btn.classList.remove('animate-spin'), 800));
    }

    setInterval(fetchData, REFRESH_INTERVAL);
    fetchData();

    // ==== RENDER DATA ====
    function renderData(data) {
      renderRounds(data);
      renderKnockout(data.semifinals, data.final);
      renderPlayers(data);
    }

    function renderRounds(data) {
      const c = document.getElementById('rounds');
      c.innerHTML = `<h2 class='text-2xl font-bold text-blue-700 mb-3 text-center'>V√≤ng B·∫£ng</h2>` +
        renderTable(data.tableA, 'B·∫£ng A') +
        renderTable(data.tableB, 'B·∫£ng B') +
        renderMatchList(data.matchesA, 'K·∫øt qu·∫£ B·∫£ng A') +
        renderMatchList(data.matchesB, 'K·∫øt qu·∫£ B·∫£ng B');
    }

    function renderTable(table, title) {
      if (!table || table.length === 0) return '';
      let html = `<div class='bg-white p-4 mt-4 rounded-xl shadow'><h3 class='text-lg font-semibold text-blue-800 mb-2 text-center'>${title}</h3>`;
      const headers = Object.keys(table[0]).filter(h => h !== 'matchesPlayed');
      html += `<div class='overflow-x-auto'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-blue-600 text-white'><tr>` +
        headers.map(h => `<th class='px-3 py-2'>${h}</th>`).join('') +
        `</tr></thead><tbody class='bg-white divide-y divide-gray-100'>`;
      table.forEach((row, i) => {
        let rowClass = i === 0 ? 'top1' : i === 1 ? 'top2' : '';
        html += `<tr class='hover:bg-blue-50 ${rowClass}'>` +
          headers.map(h => `<td class='px-3 py-2 text-center'>${row[h]}</td>`).join('') +
          `</tr>`;
      });
      html += '</tbody></table></div></div>';
      return html;
    }

    function renderMatchList(matches, title) {
      if (!matches || matches.length === 0) return '';
      let html = `<div class='bg-white p-4 mt-4 rounded-xl shadow'><h3 class='text-lg font-semibold text-blue-800 mb-2 text-center'>${title}</h3>`;
      html += `<div class='overflow-x-auto'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-blue-600 text-white'><tr><th>Gi·ªù</th><th>S√¢n</th><th>ƒê·ªôi A</th><th>T·ªâ s·ªë</th><th>ƒê·ªôi B</th></tr></thead><tbody>`;
      matches.forEach(m => {
        const aClass = m.winner === m.teamA ? 'text-green-700 font-bold' : '';
        const bClass = m.winner === m.teamB ? 'text-green-700 font-bold' : '';
        html += `<tr class='hover:bg-blue-50'><td class='px-3 py-2 text-center'>${m.time}</td><td>${m.court}</td><td class='${aClass}'>${m.teamA}</td><td class='text-center'>${m.scoreA} - ${m.scoreB}</td><td class='${bClass}'>${m.teamB}</td></tr>`;
      });
      html += '</tbody></table></div></div>';
      return html;
    }

    function renderKnockout(semis, final) {
      const c = document.getElementById('knockout');
      let html = `<h2 class='text-2xl font-bold text-green-700 mb-3 text-center'>Knock-out</h2>`;
      if (semis) html += renderMatchList(semis, 'B√°n K·∫øt');
      if (final) {
        html += `<div class='winner-box bg-white p-4 mt-4 rounded-xl shadow text-center'>
          <h3 class='text-lg font-semibold text-green-800 mb-2'>Chung K·∫øt</h3>
          <p><strong>${final.teamA}</strong> (${final.scoreA}) vs (${final.scoreB}) <strong>${final.teamB}</strong></p>
          <p class='mt-2 text-green-600 font-semibold winner-glow'>üèÜ V√¥ ƒë·ªãch: ${final.winner}</p>
          <p class='text-gray-700'>√Å qu√¢n: ${final.runnerUp}</p>
        </div>`;
      }
      c.innerHTML = html;
    }

    function renderPlayers(data) {
      const c = document.getElementById('players');
      c.in
