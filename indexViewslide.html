<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng ƒêi·ªÉm Tr·ª±c Tuy·∫øn - Vu·ªët Ngang Mobile</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: #f0f4f8; overflow-x: hidden; }
        
        /* Container ch·ª©a c√°c trang, b·∫Øt bu·ªôc ph·∫£i l√† flex v√† kh√¥ng gi·ªõi h·∫°n chi·ªÅu r·ªông */
        #content-carousel {
            display: flex;
            width: 300vw; /* 3 sections * 100vw */
            transition: transform 0.3s ease-in-out;
        }

        /* M·ªói section chi·∫øm tr·ªçn 100% viewport width, x·∫øp h√†ng ngang */
        .swipe-section {
            width: 100vw;
            flex-shrink: 0;
            padding: 1rem;
            min-height: 80vh; /* Chi·ªÅu cao t·ªëi thi·ªÉu ƒë·ªÉ d·ªÖ vu·ªët */
        }
        
        /* C·ªë ƒë·ªãnh ti√™u ƒë·ªÅ b·∫£ng */
        table thead th {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Th√™m hi·ªáu ·ª©ng cho c√°c tab active */
        .tab-indicator {
            transition: background-color 0.3s;
        }
        .tab-indicator.active {
            background-color: #0c4a6e;
            box-shadow: 0 0 0 2px #bfdbfe;
        }
    </style>
</head>
<body class="font-sans">

    <div class="fixed top-0 left-0 right-0 z-20 bg-white shadow-md p-4">
        <h1 class="text-xl font-extrabold text-blue-800 text-center">B·∫£ng ƒêi·ªÉm Pickleball Live</h1>
        
        <!-- Tab Indicators -->
        <div id="tab-controls" class="flex justify-around mt-3 mb-2 max-w-lg mx-auto">
            <button id="tab-A" onclick="goToSection(0)" class="tab-indicator active px-4 py-2 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">B·∫£ng A</button>
            <button id="tab-B" onclick="goToSection(1)" class="tab-indicator px-4 py-2 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">B·∫£ng B</button>
            <button id="tab-P" onclick="goToSection(2)" class="tab-indicator px-4 py-2 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">Chung K·∫øt</button>
        </div>
        
        <div id="statusMessage" class="mt-1 text-center text-sm font-medium text-gray-600">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        <p id="lastUpdate" class="text-xs text-gray-500 text-center"></p>
    </div>

    <!-- MAIN SWIPE CONTAINER -->
    <div id="main-content-wrapper" class="pt-[140px] md:pt-[120px]">
        <div id="content-carousel">
            
            <!-- SECTION 1: B·∫£ng A -->
            <div id="section-A" class="swipe-section">
                <section class="bg-white p-4 rounded-xl shadow-lg mb-6">
                    <h2 class="text-xl font-bold mb-3 text-indigo-700">B·∫£ng X·∫øp H·∫°ng A</h2>
                    <div id="standingsA"></div>
                </section>
                <section class="bg-white p-4 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-3 text-indigo-700">L·ªãch Thi ƒê·∫•u B·∫£ng A</h2>
                    <div id="matchesA"></div>
                </section>
            </div>

            <!-- SECTION 2: B·∫£ng B -->
            <div id="section-B" class="swipe-section">
                <section class="bg-white p-4 rounded-xl shadow-lg mb-6">
                    <h2 class="text-xl font-bold mb-3 text-indigo-700">B·∫£ng X·∫øp H·∫°ng B</h2>
                    <div id="standingsB"></div>
                </section>
                <section class="bg-white p-4 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-3 text-indigo-700">L·ªãch Thi ƒê·∫•u B·∫£ng B</h2>
                    <div id="matchesB"></div>
                </section>
            </div>

            <!-- SECTION 3: Chung K·∫øt -->
            <div id="section-Playoff" class="swipe-section">
                <section class="bg-white p-4 rounded-xl shadow-lg mb-6">
                    <h2 class="text-xl font-bold text-center mb-3 border-b pb-2 text-red-700">K·∫øt Qu·∫£ Chung Cu·ªôc</h2>
                    <div id="podiumResults" class="flex justify-center items-start">
                        <p class="text-center text-gray-500">ƒêang ch·ªù d·ªØ li·ªáu...</p>
                    </div>
                </section>
                <section class="bg-white p-4 rounded-xl shadow-lg mb-6">
                    <h2 class="text-xl font-bold mb-3 text-blue-700">Tr·∫≠n Chung K·∫øt</h2>
                    <div id="finalMatch"></div>
                </section>
                <section class="bg-white p-4 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-3 text-blue-700">V√≤ng B√°n K·∫øt</h2>
                    <div id="semifinalsMatches"></div>
                </section>
            </div>

        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH V√Ä BI·∫æN TO√ÄN C·ª§C ---
        const RAW_DATA_URL = 'https://raw.githubusercontent.com/cqtin2024/pickleball/main/data/state.json';
        const UPDATE_INTERVAL = 10000; // 10 gi√¢y

        let lastUpdateTime = '';
        let currentSectionIndex = 0; // 0: A, 1: B, 2: P

        // Bi·∫øn cho Swipe
        const carousel = document.getElementById('content-carousel');
        const sections = ['A', 'B', 'P'];
        let startX = 0;
        let deltaX = 0;
        let isSwiping = false;
        const SWIPE_THRESHOLD = 50; // Kho·∫£ng c√°ch vu·ªët t·ªëi thi·ªÉu ƒë·ªÉ chuy·ªÉn trang (pixels)

        // --- C√ÅC H√ÄM X·ª¨ L√ù VU·ªêT NGANG (SWIPE) ---

        function handleTouchStart(e) {
            startX = e.touches[0].clientX;
            isSwiping = true;
            carousel.style.transition = 'none'; // T·∫Øt transition khi b·∫Øt ƒë·∫ßu vu·ªët
        }

        function handleTouchMove(e) {
            if (!isSwiping) return;
            deltaX = e.touches[0].clientX - startX;
            // √Åp d·ª•ng transform ƒë·ªÉ di chuy·ªÉn n·ªôi dung theo ng√≥n tay
            carousel.style.transform = `translateX(calc(${currentSectionIndex * -100}vw + ${deltaX}px))`;
        }

        function handleTouchEnd() {
            if (!isSwiping) return;
            isSwiping = false;
            
            let newIndex = currentSectionIndex;

            // Vu·ªët sang tr√°i (deltaX √¢m)
            if (deltaX < -SWIPE_THRESHOLD && currentSectionIndex < sections.length - 1) {
                newIndex++;
            } 
            // Vu·ªët sang ph·∫£i (deltaX d∆∞∆°ng)
            else if (deltaX > SWIPE_THRESHOLD && currentSectionIndex > 0) {
                newIndex--;
            }
            
            // ƒê·∫∑t l·∫°i bi·∫øn deltaX v√† chuy·ªÉn ƒë·∫øn section m·ªõi
            deltaX = 0;
            goToSection(newIndex);
        }

        /**
         * Chuy·ªÉn ƒë·∫øn section mong mu·ªën (d√πng cho c·∫£ n√∫t b·∫•m v√† k·∫øt th√∫c vu·ªët).
         * @param {number} index - Ch·ªâ s·ªë c·ªßa section (0, 1, 2).
         */
        function goToSection(index) {
            currentSectionIndex = index;
            
            // K√≠ch ho·∫°t transition tr·ªü l·∫°i
            carousel.style.transition = 'transform 0.3s ease-in-out';
            
            // √Åp d·ª•ng transform ƒë·ªÉ hi·ªÉn th·ªã section m·ªõi
            carousel.style.transform = `translateX(${currentSectionIndex * -100}vw)`;
            
            // C·∫≠p nh·∫≠t indicators
            document.querySelectorAll('.tab-indicator').forEach((btn, i) => {
                if (i === currentSectionIndex) {
                    btn.classList.add('active');
                    btn.classList.remove('bg-blue-100');
                    btn.classList.add('bg-blue-600', 'text-white');
                } else {
                    btn.classList.remove('active', 'bg-blue-600', 'text-white');
                    btn.classList.add('bg-blue-100');
                }
            });
        }
        
        // --- C√ÅC H√ÄM T·∫¢I V√Ä RENDER D·ªÆ LI·ªÜU ---

        async function fetchData() {
            const response = await fetch(RAW_DATA_URL);
            if (!response.ok) {
                throw new Error(`L·ªói HTTP! Status: ${response.status}`);
            }
            return await response.json();
        }

        function updateLastUpdateTime() {
            lastUpdateTime = new Date().toLocaleTimeString('vi-VN');
            const timeElement = document.getElementById('lastUpdate');
            if (timeElement) {
                timeElement.textContent = `C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: ${lastUpdateTime}`;
            }
        }
        
        /**
         * Render b·∫£ng x·∫øp h·∫°ng.
         */
        function renderStandingsTable(standings, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const sortedStandings = [...standings].sort((a, b) => b.points - a.points || b.diff - a.diff);

            let html = `
                <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-indigo-600 text-white">
                        <tr>
                            <th class="px-3 py-2 text-center">H·∫°ng</th>
                            <th class="px-4 py-2 text-left">ƒê·ªôi</th>
                            <th class="px-3 py-2 text-center">T/B</th>
                            <th class="px-3 py-2 text-center">Diff</th>
                            <th class="px-3 py-2 text-center">ƒêi·ªÉm</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;

            sortedStandings.forEach((s, index) => {
                const rankClass = index < 2 ? 'font-bold text-lg text-green-600' : 'text-gray-900';
                html += `
                    <tr class="hover:bg-blue-50">
                        <td class="px-3 py-2 whitespace-nowrap text-center ${rankClass}">${index + 1}</td>
                        <td class="px-4 py-2 whitespace-nowrap font-medium text-gray-900">${s.team}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-center">${s.wins}/${s.losses}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-center ${s.diff >= 0 ? 'text-green-600' : 'text-red-600'}">${s.diff}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-center font-bold">${s.points}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        /**
         * Render m·ªôt t·∫≠p h·ª£p c√°c tr·∫≠n ƒë·∫•u v√†o b·∫£ng HTML.
         */
        function renderMatchTable(matches, containerId, isFinalStage = false) {
            const container = document.getElementById(containerId);
            if (!container) return;

            if (!matches || (Array.isArray(matches) && matches.length === 0)) {
                container.innerHTML = `<div class="p-3 text-center bg-gray-100 rounded-lg text-gray-600">Ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o ƒë∆∞·ª£c s·∫Øp x·∫øp.</div>`;
                return;
            }
            
            const matchesArray = Array.isArray(matches) ? matches : [matches].filter(m => m);

            let html = `
                <div class="overflow-x-auto rounded-lg shadow-md">
                    <table class="min-w-full divide-y divide-gray-200 bg-white text-sm">
                        <thead class="bg-blue-600 text-white">
                            <tr>
                                <th class="px-3 py-2 text-center">Gi·ªù</th>
                                <th class="px-3 py-2 text-center">S√¢n</th>
                                <th class="px-4 py-2 text-left">ƒê·ªôi A</th>
                                <th class="px-4 py-2 text-left">ƒê·ªôi B</th>
                                <th class="px-3 py-2 text-center">T·ªâ s·ªë</th>
                                ${isFinalStage ? `<th class="px-3 py-2 text-center">K.Qu·∫£</th>` : ''}
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
            `;

            matchesArray.forEach(match => {
                const scoreA = match.scoreA !== null ? match.scoreA : '-';
                const scoreB = match.scoreB !== null ? match.scoreB : '-';
                const isPlayed = match.scoreA !== null && match.scoreB !== null;
                const rowClass = isPlayed ? 'bg-green-50' : 'bg-white';
                
                let resultText = 'ƒêang ƒë·∫•u';
                let resultClass = 'text-gray-500';

                if (match.winner) {
                    resultText = match.winner.includes('Th·∫Øng') ? 'Ch·ªù ƒê·ªôi' : 'K·∫øt th√∫c';
                    resultClass = 'font-bold text-green-700';
                } else if (isPlayed) {
                     resultText = 'ƒê√£ ƒë·∫•u';
                     resultClass = 'text-blue-500';
                }

                const winnerClassA = isPlayed && match.winner === match.teamA ? 'font-bold text-green-700' : 'text-gray-900';
                const winnerClassB = isPlayed && match.winner === match.teamB ? 'font-bold text-green-700' : 'text-gray-900';

                html += `
                    <tr class="${rowClass} hover:bg-gray-100">
                        <td class="px-3 py-2 text-center">${match.time || 'N/A'}</td>
                        <td class="px-3 py-2 text-center font-bold text-blue-600">${match.court || 'N/A'}</td>
                        <td class="px-4 py-2 ${winnerClassA}">${match.teamA || 'Ch·ªù ƒê·ªôi'}</td>
                        <td class="px-4 py-2 ${winnerClassB}">${match.teamB || 'Ch·ªù ƒê·ªôi'}</td>
                        <td class="px-3 py-2 text-center font-bold text-base">${scoreA} - ${scoreB}</td>
                        ${isFinalStage ? `<td class="px-3 py-2 text-center ${resultClass}">${resultText}</td>` : ''}
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        /**
         * Render khu v·ª±c b·ª•c vinh quang (Podium)
         */
        function renderPodium(final, semifinals) {
            const container = document.getElementById('podiumResults');
            if (!container) return;

            let html = '';

            const champion = final?.winner;
            const runnerUp = final?.loser;
            let thirdPlaceTeams = [];

            const sf1Loser = semifinals[0]?.loser;
            const sf2Loser = semifinals[1]?.loser;

            if (sf1Loser) thirdPlaceTeams.push(sf1Loser);
            if (sf2Loser) thirdPlaceTeams.push(sf2Loser);

            const hasResults = champion || runnerUp || thirdPlaceTeams.length > 0;

            if (!hasResults) {
                container.innerHTML = `<p class="text-center text-gray-500 mt-2">K·∫øt qu·∫£ chung cu·ªôc ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</p>`;
                return;
            }
            
            html = `<div class="flex flex-col items-center space-y-4 w-full">`;

            // Champion
            if (champion) {
                html += `
                    <div class="bg-yellow-500 text-white p-4 rounded-xl shadow-2xl w-full max-w-sm text-center">
                        <span class="text-3xl">ü•á</span>
                        <p class="text-xl font-extrabold mt-1">V√¥ ƒê·ªãch</p>
                        <p class="text-2xl font-black">${champion}</p>
                    </div>
                `;
            }

            // Runner Up
            if (runnerUp) {
                html += `
                    <div class="bg-gray-400 text-white p-3 rounded-xl shadow-xl w-full max-w-xs text-center">
                        <span class="text-2xl">ü•à</span>
                        <p class="text-lg font-bold mt-1">√Å Qu√¢n</p>
                        <p class="text-xl font-extrabold">${runnerUp}</p>
                    </div>
                `;
            }

            // Third Place (ƒë·ªìng h·∫°ng 3)
            if (thirdPlaceTeams.length > 0) {
                const thirdPlaceHtml = thirdPlaceTeams.map(team =>
                    `<span class="inline-block bg-amber-800 text-white px-3 py-1 rounded-full text-sm font-semibold m-1">${team}</span>`
                ).join('');

                html += `
                    <div class="bg-amber-800 text-white p-3 rounded-xl shadow-lg w-full max-w-sm text-center">
                        <span class="text-xl">ü•â</span>
                        <p class="text-md font-bold mt-1">H·∫°ng Ba (ƒê·ªìng h·∫°ng)</p>
                        <div class="mt-2 flex flex-wrap justify-center">${thirdPlaceHtml}</div>
                    </div>
                `;
            }
            
            html += `</div>`;
            container.innerHTML = html;
        }

        /**
         * H√†m ch√≠nh ƒë·ªÉ t·∫£i v√† c·∫≠p nh·∫≠t d·ªØ li·ªáu.
         */
        async function fetchAndUpdateData() {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';
            statusElement.classList.remove('text-red-600', 'text-green-600');
            statusElement.classList.add('text-gray-600');

            try {
                const data = await fetchData();
                
                // --- Render B·∫£ng A ---
                renderStandingsTable(data.standingsA || [], 'standingsA');
                renderMatchTable(data.matchesA || [], 'matchesA');

                // --- Render B·∫£ng B ---
                renderStandingsTable(data.standingsB || [], 'standingsB');
                renderMatchTable(data.matchesB || [], 'matchesB');

                // --- Render Chung K·∫øt ---
                renderMatchTable(data.semifinals || [], 'semifinalsMatches', true);
                renderMatchTable(data.final || {}, 'finalMatch', true);
                renderPodium(data.final || {}, data.semifinals || []);

                updateLastUpdateTime();
                
                statusElement.textContent = 'ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu tr·ª±c ti·∫øp.';
                statusElement.classList.remove('text-gray-600', 'text-red-600');
                statusElement.classList.add('text-green-600');

            } catch (error) {
                statusElement.textContent = `L·ªói t·∫£i d·ªØ li·ªáu. Th·ª≠ l·∫°i trong 10 gi√¢y.`;
                statusElement.classList.remove('text-gray-600', 'text-green-600');
                statusElement.classList.add('text-red-600');
            }
        }

        // --- KH·ªûI T·∫†O V√Ä L·∫ÆNG NGHE S·ª∞ KI·ªÜN ---

        window.onload = () => {
            // Th√™m listeners cho Swipe
            carousel.addEventListener('touchstart', handleTouchStart);
            carousel.addEventListener('touchmove', handleTouchMove);
            carousel.addEventListener('touchend', handleTouchEnd);
            
            // ƒê·∫£m b·∫£o tab ƒë·∫ßu ti√™n l√† active khi load
            goToSection(0); 

            // B·∫Øt ƒë·∫ßu t·∫£i d·ªØ li·ªáu
            fetchAndUpdateData(); 
            setInterval(fetchAndUpdateData, UPDATE_INTERVAL);
        };

        // ƒê·∫∑t h√†m goToSection v√†o window scope ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ HTML onclick
        window.goToSection = goToSection;
    </script>
</body>
</html>
