<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TKD PICKLEBALL CHAMPIONSHIP 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f0f4f8; overflow-x: hidden; }
    #content-carousel { display: flex; width: 300vw; transition: transform 0.3s ease-in-out; }
    .swipe-section { width: 100vw; flex-shrink: 0; padding: 1rem; min-height: calc(100vh - 160px); overflow-y: auto; }
    #refresh-btn { position: fixed; bottom: 20px; right: 20px; z-index: 50; background-color: #0284c7; color: white; font-weight: bold; padding: 14px; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.2s; }
    #refresh-btn:hover { transform: scale(1.1); background-color: #0369a1; }
  </style>
</head>
<body class="font-sans">
  <!-- PH·∫¶N TI√äU ƒê·ªÄ C·ªê ƒê·ªäNH -->
  <header class="fixed top-0 left-0 right-0 z-30 bg-white shadow-md p-4">
    <h1 class="text-xl font-extrabold text-blue-800 text-center">üèÜ TKD PICKLEBALL CHAMPIONSHIP 2025</h1>
    <p class="text-center text-gray-600 text-sm">Ng√†y 18/10/2025</p>

    <div id="tab-controls" class="flex justify-around mt-3 mb-2 max-w-lg mx-auto">
      <button onclick="goToSection(0)" class="tab-btn active px-4 py-2 text-sm font-semibold rounded-full bg-blue-600 text-white">V√≤ng B·∫£ng</button>
      <button onclick="goToSection(1)" class="tab-btn px-4 py-2 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">B√°n K·∫øt</button>
      <button onclick="goToSection(2)" class="tab-btn px-4 py-2 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">Chung K·∫øt</button>
    </div>

    <div id="statusMessage" class="text-center text-sm font-medium text-gray-600">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  </header>

  <!-- PH·∫¶N N·ªòI DUNG CH√çNH (VU·ªêT NGANG) -->
  <main id="main-content-wrapper" class="pt-[180px] md:pt-[150px] overflow-hidden">
    <div id="content-carousel">
      <section class="swipe-section" id="rounds"></section>
      <section class="swipe-section" id="semifinals"></section>
      <section class="swipe-section" id="finals"></section>
    </div>
  </main>

  <!-- N√öT N·ªîI L√ÄM M·ªöI -->
  <button id="refresh-btn" title="T·∫£i l·∫°i d·ªØ li·ªáu" onclick="manualRefresh()">‚ü≥</button>

  <script>
    const BASE_URL = window.location.hostname.includes('github.io') ? './data/state.json' : 'https://raw.githubusercontent.com/cqtin2024/pickleball/main/data/state.json';
    const REFRESH_INTERVAL = 30000; // 30 gi√¢y

    const carousel = document.getElementById('content-carousel');
    let currentIndex = 0;
    let startX = 0, deltaX = 0, isSwiping = false;

    function goToSection(index) {
      currentIndex = index;
      carousel.style.transform = `translateX(${index * -100}vw)`;
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        btn.classList.toggle('bg-blue-600', i === index);
        btn.classList.toggle('text-white', i === index);
        btn.classList.toggle('bg-blue-100', i !== index);
        btn.classList.toggle('text-blue-800', i !== index);
      });
    }

    function handleTouchStart(e) { startX = e.touches[0].clientX; isSwiping = true; carousel.style.transition = 'none'; }
    function handleTouchMove(e) { if (!isSwiping) return; deltaX = e.touches[0].clientX - startX; carousel.style.transform = `translateX(calc(${currentIndex * -100}vw + ${deltaX}px))`; }
    function handleTouchEnd() {
      if (!isSwiping) return;
      isSwiping = false;
      if (deltaX < -50 && currentIndex < 2) currentIndex++;
      else if (deltaX > 50 && currentIndex > 0) currentIndex--;
      goToSection(currentIndex);
      carousel.style.transition = 'transform 0.3s ease-in-out';
      deltaX = 0;
    }

    carousel.addEventListener('touchstart', handleTouchStart);
    carousel.addEventListener('touchmove', handleTouchMove);
    carousel.addEventListener('touchend', handleTouchEnd);

    async function fetchData() {
      const msg = document.getElementById('statusMessage');
      msg.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';
      try {
        const res = await fetch(BASE_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i file JSON');
        const data = await res.json();
        msg.textContent = 'ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng (' + new Date().toLocaleTimeString('vi-VN') + ')';
        renderData(data);
      } catch (err) {
        msg.textContent = '‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu: ' + err.message;
      }
    }

    function manualRefresh() {
      document.getElementById('refresh-btn').classList.add('animate-spin');
      fetchData().finally(() => {
        setTimeout(() => document.getElementById('refresh-btn').classList.remove('animate-spin'), 800);
      });
    }

    function renderData(data) {
      renderTable(data.rounds || data.matches || [], 'rounds', 'V√≤ng B·∫£ng');
      renderTable(data.semifinals || [], 'semifinals', 'B√°n K·∫øt');
      renderTable(data.final || data.finals || [], 'finals', 'Chung K·∫øt');
    }

    function renderTable(list, containerId, title) {
      const container = document.getElementById(containerId);
      if (!list || list.length === 0) {
        container.innerHTML = `<div class='text-center text-gray-500 mt-10'>Kh√¥ng c√≥ d·ªØ li·ªáu ${title}</div>`;
        return;
      }

      let html = `<div class='bg-white p-4 rounded-xl shadow-lg'><h2 class='text-xl font-bold text-blue-700 mb-3 text-center'>${title}</h2>`;
      html += `<div class='overflow-x-auto'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-blue-600 text-white sticky top-0'><tr>`;
      const keys = Object.keys(list[0]);
      keys.forEach(k => html += `<th class='px-3 py-2'>${k}</th>`);
      html += `</tr></thead><tbody class='bg-white divide-y divide-gray-100'>`;
      list.forEach(item => {
        html += `<tr class='hover:bg-blue-50'>${keys.map(k => `<td class='px-3 py-2 text-center'>${item[k] ?? ''}</td>`).join('')}</tr>`;
      });
      html += '</tbody></table></div></div>';
      container.innerHTML = html;
    }

    // Refresh t·ª± ƒë·ªông m·ªói 30 gi√¢y
    setInterval(fetchData, REFRESH_INTERVAL);

    // Cho ph√©p ng∆∞·ªùi d√πng F5 th·ªß c√¥ng ƒë·ªÉ l√†m m·ªõi ngay
    window.addEventListener('focus', fetchData);

    // Kh·ªüi ƒë·ªông l·∫ßn ƒë·∫ßu
    fetchData();
  </script>
</body>
</html>
